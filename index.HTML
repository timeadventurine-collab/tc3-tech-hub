<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TC3 TECH-HUB</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Syne:wght@700;800&display=swap" rel="stylesheet">

    <style>
        /* ===== ROOT VARIABLES ===== */
        :root {
            --blue: #3b82f6;
            --purple: #8b5cf6;
            --pink: #d946ef;
            --glow-blue: rgba(59,130,246,0.35);
            --glow-purple: rgba(139,92,246,0.25);
            --bg-deep: #050a14;
            --bg-card: #0f172a;
            --border: rgba(255,255,255,0.07);
        }

        /* ===== BASE ===== */
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-deep);
            color: white;
            overflow-x: hidden;
        }

        .font-display { font-family: 'Syne', sans-serif; }

        .text-gradient {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6, #d946ef);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .text-gradient-subtle {
            background: linear-gradient(90deg, #93c5fd, #c4b5fd);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* ===== BACKGROUND GRID ===== */
        .bg-grid {
            background-image:
                linear-gradient(rgba(59,130,246,0.04) 1px, transparent 1px),
                linear-gradient(90deg, rgba(59,130,246,0.04) 1px, transparent 1px);
            background-size: 60px 60px;
        }

        /* ===== NOISE TEXTURE ===== */
        .noise::before {
            content: '';
            position: fixed;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.02'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 1000;
            opacity: 0.4;
        }

        /* ===== HEADER ===== */
        #header-user nav a {
            position: relative;
            transition: all 0.35s cubic-bezier(0.4,0,0.2,1);
            padding-bottom: 4px;
        }
        #header-user nav a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(90deg, var(--blue), var(--purple));
            border-radius: 4px;
            transition: width 0.35s cubic-bezier(0.4,0,0.2,1);
            box-shadow: 0 0 8px var(--glow-blue);
        }
        #header-user nav a:hover {
            color: #93c5fd;
            text-shadow: 0 0 20px var(--glow-blue);
            transform: translateY(-1px);
        }
        #header-user nav a:hover::after { width: 100%; }
        #header-user nav a.active-nav {
            color: var(--blue);
        }
        #header-user nav a.active-nav::after { width: 100%; }

        /* Header glow on hover for buttons */
        .header-btn-glow {
            position: relative;
            transition: all 0.3s ease;
        }
        .header-btn-glow:hover {
            box-shadow: 0 0 20px var(--glow-blue), 0 0 40px rgba(59,130,246,0.15);
        }

        /* ===== PRODUCT GRID ===== */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            padding: 0.5rem 0;
        }

        /* ===== PRODUCT CARD ===== */
        .product-card {
            background: linear-gradient(145deg, #0f172a, #0a1120);
            border: 1px solid rgba(59,130,246,0.12);
            border-radius: 16px;
            padding: 1.25rem;
            transition: all 0.4s cubic-bezier(0.4,0,0.2,1);
            position: relative;
            overflow: hidden;
        }
        .product-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(59,130,246,0.05), rgba(139,92,246,0.05));
            opacity: 0;
            transition: opacity 0.4s ease;
            border-radius: 16px;
        }
        .product-card:hover {
            border-color: rgba(59,130,246,0.4);
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.4), 0 0 30px rgba(59,130,246,0.1);
        }
        .product-card:hover::before { opacity: 1; }

        /* ===== LOCK OVERLAY ===== */
        .lock-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 20;
            background: rgba(5,10,20,0.7);
            backdrop-filter: blur(2px);
            text-align: center;
            padding: 20px;
        }

        /* ===== SECTION ANIMATIONS ===== */
        .section-content { animation: fadeSlideUp 0.5s ease-out both; }
        @keyframes fadeSlideUp {
            from { opacity: 0; transform: translateY(24px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-12px) rotate(3deg); }
        }
        @keyframes floatReverse {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-8px) rotate(-4deg); }
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px var(--glow-blue); }
            50% { box-shadow: 0 0 40px var(--glow-blue), 0 0 80px var(--glow-purple); }
        }
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @keyframes blink-cursor {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        @keyframes orbit {
            from { transform: rotate(0deg) translateX(60px) rotate(0deg); }
            to { transform: rotate(360deg) translateX(60px) rotate(-360deg); }
        }

        .float-anim { animation: float 6s ease-in-out infinite; }
        .float-anim-2 { animation: floatReverse 8s ease-in-out infinite; }
        .float-anim-3 { animation: float 10s ease-in-out infinite 2s; }

        /* ===== WELCOME SCREEN ===== */
        .welcome-card {
            background: linear-gradient(135deg, rgba(15,23,42,0.95), rgba(10,17,32,0.98));
            border: 1px solid rgba(59,130,246,0.2);
            border-radius: 24px;
            backdrop-filter: blur(20px);
            box-shadow: 0 0 60px rgba(59,130,246,0.08), 0 40px 80px rgba(0,0,0,0.4);
            animation: pulse-glow 4s ease-in-out infinite;
        }

        .welcome-badge {
            background: linear-gradient(90deg, rgba(59,130,246,0.15), rgba(139,92,246,0.15));
            border: 1px solid rgba(59,130,246,0.3);
            border-radius: 50px;
            padding: 6px 16px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: #93c5fd;
        }

        .welcome-stat-card {
            background: rgba(59,130,246,0.07);
            border: 1px solid rgba(59,130,246,0.15);
            border-radius: 12px;
            padding: 12px 16px;
            transition: all 0.3s ease;
        }
        .welcome-stat-card:hover {
            background: rgba(59,130,246,0.12);
            border-color: rgba(59,130,246,0.3);
            transform: scale(1.03);
        }

        .deco-ring {
            border: 1px solid rgba(59,130,246,0.15);
            border-radius: 50%;
            position: absolute;
        }

        /* ===== UPLOAD BOX ===== */
        .upload-box {
            border: 2px dashed rgba(59,130,246,0.3);
            border-radius: 20px;
            transition: all 0.4s cubic-bezier(0.4,0,0.2,1);
            position: relative;
            overflow: hidden;
        }
        .upload-box::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(59,130,246,0.05), rgba(139,92,246,0.05));
            opacity: 0;
            transition: opacity 0.4s ease;
        }
        .upload-box:hover {
            border-color: rgba(59,130,246,0.7);
            background: rgba(59,130,246,0.06);
            box-shadow: 0 0 30px rgba(59,130,246,0.1), inset 0 0 30px rgba(59,130,246,0.03);
        }
        .upload-box:hover::before { opacity: 1; }

        .plus-btn {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-radius: 50%;
            width: 64px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow: 0 0 20px rgba(59,130,246,0.4);
        }
        .plus-btn:hover {
            transform: scale(1.1) rotate(45deg);
            box-shadow: 0 0 40px rgba(59,130,246,0.6), 0 0 80px rgba(139,92,246,0.3);
        }

        /* ===== LOADING OVERLAY ===== */
        #upload-loading-overlay {
            background: rgba(5,10,20,0.97);
            backdrop-filter: blur(20px);
        }
        .loading-ring {
            width: 80px;
            height: 80px;
            border: 3px solid rgba(59,130,246,0.1);
            border-top-color: var(--blue);
            border-right-color: var(--purple);
            border-radius: 50%;
            animation: spin-slow 1s linear infinite;
        }
        .loading-progress {
            background: linear-gradient(90deg, var(--blue), var(--purple), var(--pink), var(--blue));
            background-size: 200% 100%;
            animation: shimmer 2s linear infinite;
            border-radius: 50px;
            height: 3px;
        }

        /* ===== PREVIEW MODAL ===== */
        #preview-modal {
            background: rgba(5,10,20,0.95);
            backdrop-filter: blur(30px);
        }
        .preview-panel {
            background: linear-gradient(145deg, #0f172a, #080f1d);
            border: 1px solid rgba(59,130,246,0.15);
            border-radius: 20px;
        }
        .demo-frame {
            background: linear-gradient(135deg, #080f1d, #0a1020);
            border: 1px solid rgba(59,130,246,0.1);
            border-radius: 16px;
            overflow: hidden;
        }
        .thumbnail-upload-zone {
            border: 2px dashed rgba(59,130,246,0.25);
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .thumbnail-upload-zone:hover {
            border-color: rgba(59,130,246,0.6);
            background: rgba(59,130,246,0.05);
        }
        .upload-btn-main {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-radius: 14px;
            padding: 14px 32px;
            font-weight: 700;
            font-size: 15px;
            transition: all 0.4s ease;
            box-shadow: 0 0 20px rgba(59,130,246,0.3);
            border: none;
            cursor: pointer;
            color: white;
        }
        .upload-btn-main:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 40px rgba(59,130,246,0.5), 0 8px 30px rgba(0,0,0,0.3);
        }
        .upload-btn-main:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* ===== SUCCESS OVERLAY ===== */
        #success-overlay {
            background: rgba(5,10,20,0.97);
            backdrop-filter: blur(30px);
        }
        .success-icon-ring {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 2px solid rgba(34,197,94,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .success-icon-ring::before {
            content: '';
            position: absolute;
            inset: -8px;
            border-radius: 50%;
            border: 1px solid rgba(34,197,94,0.1);
            animation: spin-slow 4s linear infinite;
        }
        .success-icon-ring::after {
            content: '';
            position: absolute;
            inset: -16px;
            border-radius: 50%;
            border: 1px dashed rgba(34,197,94,0.07);
            animation: spin-slow 8s linear infinite reverse;
        }
        @keyframes successPop {
            0% { opacity: 0; transform: scale(0.7); }
            60% { transform: scale(1.05); }
            100% { opacity: 1; transform: scale(1); }
        }
        .success-pop { animation: successPop 0.5s cubic-bezier(0.4,0,0.2,1) forwards; }

        /* ===== DIVIDER ===== */
        .gradient-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(59,130,246,0.4), rgba(139,92,246,0.4), transparent);
        }

        /* ===== SEARCH ===== */
        .search-results {
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            right: 0;
            background: #0f172a;
            border: 1px solid rgba(59,130,246,0.2);
            border-radius: 14px;
            overflow: hidden;
            z-index: 100;
            display: none;
            box-shadow: 0 20px 50px rgba(0,0,0,0.4);
        }
        .search-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(255,255,255,0.04);
        }
        .search-item:last-child { border-bottom: none; }
        .search-item:hover { background: rgba(59,130,246,0.1); }

        /* ===== DROPDOWN ===== */
        .dropdown-menu { transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); transform-origin: top right; }
        .hidden-dropdown { opacity: 0; transform: scale(0.95) translateY(-8px); pointer-events: none; }
        .visible-dropdown { opacity: 1; transform: scale(1) translateY(0); pointer-events: all; }

        /* ===== MODAL OVERLAYS ===== */
        .modal-overlay { background: rgba(5, 10, 20, 0.85); backdrop-filter: blur(8px); }

        /* ===== TOAST ===== */
        #toast {
            background: linear-gradient(135deg, rgba(15,23,42,0.95), rgba(10,17,32,0.98));
            border: 1px solid rgba(59,130,246,0.25);
            backdrop-filter: blur(20px);
            box-shadow: 0 10px 40px rgba(0,0,0,0.4), 0 0 20px rgba(59,130,246,0.1);
        }

        /* ===== SCROLLBAR ===== */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0a0f1e; }
        ::-webkit-scrollbar-thumb { background: rgba(59,130,246,0.3); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(59,130,246,0.5); }

        /* ===== INPUT FOCUS ===== */
        input:focus, textarea:focus {
            box-shadow: 0 0 0 2px rgba(59,130,246,0.2);
        }

        /* ===== GLASS CARD ===== */
        .glass-card {
            background: linear-gradient(145deg, rgba(15,23,42,0.8), rgba(8,15,29,0.9));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(59,130,246,0.12);
        }

        /* ===== GLOW BLOB ===== */
        .glow-blob {
            pointer-events: none;
            filter: blur(80px);
            border-radius: 50%;
            position: absolute;
        }
    </style>

    <!-- ===== COMMUNITY MODULE STYLES ===== -->
    <!-- Scoped under .comm-* prefix to avoid ANY conflict with existing styles -->
    <style>
        /* ‚îÄ‚îÄ Community CSS Variables (self-contained) ‚îÄ‚îÄ */
        .comm-root {
            --ca1: #6c63ff;
            --ca2: #00d4ff;
            --ca3: #ff6b9d;
            --ca4: #ffd166;
            --cgreen: #06ffa5;
            --cglass: rgba(255,255,255,0.04);
            --cborder: rgba(255,255,255,0.08);
            --cborder2: rgba(255,255,255,0.14);
            --cmuted: #6b7280;
            --ctext: #e8eaf0;
            --cr: 16px;
            --cr2: 12px;
            --cshadow: 0 8px 32px rgba(0,0,0,0.5);
        }

        /* ‚îÄ‚îÄ Community section wrapper ‚îÄ‚îÄ */
        #community-section {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 24px 40px;
            font-family: 'Inter', sans-serif;
        }

        /* ‚îÄ‚îÄ Community sub-views ‚îÄ‚îÄ */
        .comm-view { display: none; animation: commFadeSlide .35s ease; }
        .comm-view.comm-active { display: block; }
        @keyframes commFadeSlide {
            from { opacity: 0; transform: translateY(12px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        /* ‚îÄ‚îÄ Community hover dropdown on nav link ‚îÄ‚îÄ */
        .comm-nav-wrap { position: relative; display: inline-block; }
        .comm-nav-wrap .comm-dropdown {
            position: absolute; top: calc(100% + 10px); left: 50%;
            transform: translateX(-50%);
            width: 300px; padding: 14px;
            background: rgba(10,15,28,0.97);
            backdrop-filter: blur(24px);
            border: 1px solid rgba(255,255,255,0.14);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5), 0 0 50px rgba(108,99,255,0.12);
            display: none;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            z-index: 999;
            animation: commPopIn .2s ease;
        }
        @keyframes commPopIn {
            from { opacity: 0; transform: translateX(-50%) translateY(-6px) scale(.97); }
            to   { opacity: 1; transform: translateX(-50%) translateY(0) scale(1); }
        }
        .comm-nav-wrap:hover .comm-dropdown { display: grid; }
        .comm-dd-item {
            padding: 12px; border-radius: 12px;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.07);
            cursor: pointer; transition: all .2s;
            display: flex; flex-direction: column; gap: 4px;
        }
        .comm-dd-item:hover {
            background: rgba(108,99,255,0.12);
            border-color: rgba(108,99,255,0.4);
            transform: translateY(-2px);
        }
        .comm-dd-icon { font-size: 1.3rem; }
        .comm-dd-label { font-size: 0.78rem; font-weight: 700; color: #e8eaf0; }
        .comm-dd-desc  { font-size: 0.68rem; color: #6b7280; }

        /* ‚îÄ‚îÄ Section header ‚îÄ‚îÄ */
        .comm-section-header {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 20px; padding-top: 8px;
        }
        .comm-section-title {
            font-family: 'Syne', sans-serif; font-size: 1.4rem; font-weight: 800;
            background: linear-gradient(135deg, #e8eaf0, #6b7280);
            -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;
        }
        .comm-badge-live {
            padding: 4px 12px; border-radius: 20px; font-size: 0.7rem; font-weight: 700;
            background: linear-gradient(135deg, rgba(6,255,165,0.15), rgba(0,212,255,0.1));
            border: 1px solid rgba(6,255,165,0.3); color: #06ffa5;
            display: flex; align-items: center; gap: 6px;
            animation: commPulseLive 2s infinite;
        }
        .comm-badge-live::before {
            content: ''; width: 6px; height: 6px; border-radius: 50%;
            background: #06ffa5; animation: commPulseLive 2s infinite;
        }
        @keyframes commPulseLive {
            0%,100% { box-shadow: 0 0 0 0 rgba(6,255,165,0.4); }
            50%      { box-shadow: 0 0 0 6px rgba(6,255,165,0); }
        }

        /* ‚îÄ‚îÄ Back button ‚îÄ‚îÄ */
        .comm-back-btn {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 7px 16px; border-radius: 10px;
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            font-size: 0.82rem; font-weight: 600; color: #6b7280;
            cursor: pointer; transition: all .2s; margin-bottom: 16px;
        }
        .comm-back-btn:hover { border-color: rgba(255,255,255,0.2); color: #e8eaf0; }

        /* ‚îÄ‚îÄ Card ‚îÄ‚îÄ */
        .comm-card {
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 16px; padding: 20px;
            backdrop-filter: blur(16px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            transition: border-color .2s;
        }
        .comm-card:hover { border-color: rgba(255,255,255,0.14); }
        .comm-card-title {
            font-family: 'Syne', sans-serif; font-size: 0.92rem; font-weight: 700;
            display: flex; align-items: center; gap: 8px; margin-bottom: 16px;
        }
        .comm-card-title span {
            background: linear-gradient(135deg, #6c63ff, #00d4ff);
            -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;
        }

        /* ‚îÄ‚îÄ Community 2-col layout ‚îÄ‚îÄ */
        .comm-layout {
            display: grid;
            grid-template-columns: 310px 1fr;
            gap: 22px; align-items: start;
        }
        @media(max-width: 900px) { .comm-layout { grid-template-columns: 1fr; } }

        /* ‚îÄ‚îÄ Leaderboard ‚îÄ‚îÄ */
        .comm-lb-row {
            display: flex; align-items: center; gap: 12px;
            padding: 10px 12px; border-radius: 10px;
            background: rgba(255,255,255,0.04); margin-bottom: 8px;
            border: 1px solid transparent; transition: all .2s;
        }
        .comm-lb-row:hover { border-color: rgba(255,255,255,0.14); background: rgba(108,99,255,0.07); }
        .comm-lb-rank {
            width: 26px; height: 26px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.72rem; font-weight: 800; flex-shrink: 0;
        }
        .comm-rank-1 { background: linear-gradient(135deg,#ffd700,#ff8c00); color:#000; }
        .comm-rank-2 { background: linear-gradient(135deg,#c0c0c0,#a8a8a8); color:#000; }
        .comm-rank-3 { background: linear-gradient(135deg,#cd7f32,#a0522d); color:#fff; }
        .comm-rank-other { background: #111827; color: #6b7280; }
        .comm-lb-ava {
            width: 34px; height: 34px; border-radius: 50%;
            background: linear-gradient(135deg,#6c63ff,#00d4ff);
            display: flex; align-items: center; justify-content: center;
            font-size: 0.82rem; font-weight: 700; flex-shrink: 0; overflow: hidden;
        }
        .comm-lb-ava img { width:100%; height:100%; object-fit:cover; }
        .comm-lb-info { flex:1; min-width:0; }
        .comm-lb-name { font-size: 0.83rem; font-weight: 600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; color:#e8eaf0; }
        .comm-lb-pts  { font-size: 0.7rem; color: #6b7280; }
        .comm-lb-badge {
            font-size: 0.68rem; font-weight: 700; padding: 2px 8px; border-radius: 20px;
            background: linear-gradient(135deg,rgba(108,99,255,0.2),rgba(0,212,255,0.2));
            border: 1px solid rgba(108,99,255,0.3); color: #00d4ff;
        }

        /* ‚îÄ‚îÄ Full Leaderboard ‚îÄ‚îÄ */
        .comm-lb-full-row {
            display: flex; align-items: center; gap: 16px;
            padding: 15px 18px; border-radius: 12px;
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            margin-bottom: 10px; transition: all .2s;
        }
        .comm-lb-full-row:hover { border-color: rgba(255,255,255,0.14); transform: translateX(4px); }
        .comm-lb-full-rank { font-family:'Syne',sans-serif; font-size:1.5rem; font-weight:800; width:48px; text-align:center; }
        .comm-rank-gold   { background:linear-gradient(135deg,#ffd700,#ff8c00); -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent; }
        .comm-rank-silver { background:linear-gradient(135deg,#e0e0e0,#bdbdbd); -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent; }
        .comm-rank-bronze { background:linear-gradient(135deg,#cd7f32,#8b4513); -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent; }
        .comm-lb-full-ava {
            width:50px; height:50px; border-radius:50%;
            background:linear-gradient(135deg,#6c63ff,#00d4ff);
            display:flex; align-items:center; justify-content:center;
            font-weight:700; font-size:1.05rem;
            border:2px solid rgba(108,99,255,0.3); overflow:hidden; flex-shrink:0;
        }
        .comm-lb-full-ava img { width:100%; height:100%; object-fit:cover; }
        .comm-lb-full-info { flex:1; }
        .comm-lb-full-name { font-size:0.95rem; font-weight:700; font-family:'Syne',sans-serif; color:#e8eaf0; }
        .comm-lb-full-sub  { font-size:0.75rem; color:#6b7280; margin-top:2px; }
        .comm-progress-bar { height:4px; border-radius:2px; background:rgba(255,255,255,0.06); margin-top:6px; overflow:hidden; }
        .comm-progress-fill { height:100%; border-radius:2px; background:linear-gradient(90deg,#6c63ff,#00d4ff); transition:width .6s ease; }
        .comm-lb-full-pts { font-family:'Syne',sans-serif; font-size:1.05rem; font-weight:800; background:linear-gradient(135deg,#6c63ff,#00d4ff); -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent; }

        /* ‚îÄ‚îÄ Mini Chat ‚îÄ‚îÄ */
        .comm-chat-box {
            height: 260px; overflow-y: auto;
            display: flex; flex-direction: column; gap: 8px;
            padding: 12px; background: rgba(0,0,0,0.2);
            border-radius: 12px; margin-bottom: 12px;
            border: 1px solid rgba(255,255,255,0.08);
        }
        .comm-chat-msg { display: flex; gap: 8px; animation: commFadeSlide .2s ease; }
        .comm-chat-msg .cc-ava {
            width: 28px; height: 28px; border-radius: 50%; flex-shrink: 0;
            background: linear-gradient(135deg,#6c63ff,#ff6b9d);
            display: flex; align-items: center; justify-content: center;
            font-size: 0.68rem; font-weight: 700; color: #fff;
        }
        .comm-chat-msg .cc-body { flex:1; }
        .comm-chat-msg .cc-name { font-size: 0.68rem; font-weight: 700; color: #00d4ff; margin-bottom: 2px; }
        .comm-chat-msg .cc-text {
            font-size: 0.78rem; background: rgba(255,255,255,0.04);
            padding: 6px 10px; border-radius: 0 8px 8px 8px;
            border: 1px solid rgba(255,255,255,0.08); line-height: 1.5; word-break: break-word;
            color: #e8eaf0;
        }
        .comm-chat-msg.comm-me .cc-text {
            background: linear-gradient(135deg,rgba(108,99,255,0.2),rgba(0,212,255,0.1));
            border-color: rgba(108,99,255,0.3); border-radius: 8px 0 8px 8px;
        }
        .comm-chat-input-row { display: flex; gap: 8px; }
        .comm-chat-input {
            flex:1; padding: 9px 13px; border-radius: 10px;
            background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08);
            font-size: 0.83rem; color: #e8eaf0; transition: border-color .2s;
            font-family: 'Inter', sans-serif;
        }
        .comm-chat-input:focus { border-color: #6c63ff; outline: none; }
        .comm-chat-send {
            padding: 9px 14px; border-radius: 10px;
            background: linear-gradient(135deg,#6c63ff,#00d4ff);
            color: #fff; font-size: 0.83rem; font-weight: 700;
            border: none; cursor: pointer; transition: all .2s;
        }
        .comm-chat-send:hover { opacity: .85; transform: scale(.97); }

        /* ‚îÄ‚îÄ Full Chat Page ‚îÄ‚îÄ */
        .comm-chat-full {
            max-width: 760px; margin: 0 auto;
            display: flex; flex-direction: column; height: calc(100vh - 220px);
        }
        .comm-chat-full-box {
            flex:1; overflow-y:auto;
            display:flex; flex-direction:column; gap:12px;
            padding:20px; background:rgba(0,0,0,0.2);
            border-radius:16px 16px 0 0;
            border:1px solid rgba(255,255,255,0.08); border-bottom:none;
        }
        .comm-chat-full-input-row {
            display:flex; gap:0;
            background:rgba(10,15,28,0.9);
            border:1px solid rgba(255,255,255,0.08);
            border-radius:0 0 16px 16px; overflow:hidden;
            backdrop-filter:blur(20px);
        }
        .comm-chat-full-input {
            flex:1; padding:15px 18px; font-size:0.88rem; color:#e8eaf0;
            background:transparent; font-family:'Inter',sans-serif;
        }
        .comm-chat-full-input:focus { outline:none; }
        .comm-chat-full-send {
            padding:12px 22px;
            background:linear-gradient(135deg,#6c63ff,#00d4ff);
            color:#fff; font-size:0.88rem; font-weight:700;
            border:none; cursor:pointer; transition:opacity .2s;
        }
        .comm-chat-full-send:hover { opacity:.85; }

        /* ‚îÄ‚îÄ Post Composer ‚îÄ‚îÄ */
        .comm-composer {
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 16px; padding: 20px; margin-bottom: 20px;
            backdrop-filter: blur(16px);
        }
        .comm-composer-title {
            font-family: 'Syne',sans-serif; font-size: 0.95rem; font-weight: 700;
            margin-bottom: 14px; color: #e8eaf0;
        }
        .comm-compose-input {
            width:100%; padding:11px 15px; border-radius:10px;
            background:rgba(0,0,0,0.25); border:1px solid rgba(255,255,255,0.08);
            font-size:0.88rem; color:#e8eaf0; margin-bottom:10px;
            transition:border-color .2s; font-family:'Inter',sans-serif;
        }
        .comm-compose-input:focus  { border-color:#6c63ff; outline:none; }
        .comm-compose-area {
            width:100%; padding:11px 15px; border-radius:10px;
            background:rgba(0,0,0,0.25); border:1px solid rgba(255,255,255,0.08);
            font-size:0.85rem; color:#e8eaf0; resize:vertical; min-height:95px;
            line-height:1.6; margin-bottom:10px; transition:border-color .2s;
            font-family:'Inter',sans-serif;
        }
        .comm-compose-area:focus { border-color:#6c63ff; outline:none; }
        .comm-compose-code {
            width:100%; padding:11px 15px; border-radius:10px;
            background:rgba(0,0,0,0.5); border:1px solid rgba(108,99,255,0.25);
            font-size:0.78rem; color:#a5b4fc; resize:vertical; min-height:80px;
            line-height:1.6; margin-bottom:10px; font-family:'Courier New',monospace;
            transition:border-color .2s; display:none;
        }
        .comm-compose-code:focus { border-color:#6c63ff; outline:none; }
        .comm-tags-row { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px; align-items:center; }
        .comm-tag-chip {
            padding:3px 10px; border-radius:20px; font-size:0.72rem; font-weight:600;
            background:rgba(108,99,255,0.15); border:1px solid rgba(108,99,255,0.3); color:#6c63ff;
            cursor:pointer; transition:all .2s; display:flex; align-items:center; gap:4px;
        }
        .comm-tag-chip:hover { background:rgba(108,99,255,0.3); }
        .comm-tag-chip .ctrm { opacity:.6; font-size:0.68rem; }
        .comm-tag-input {
            flex:1; min-width:110px; padding:3px 11px; border-radius:20px;
            background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.08);
            font-size:0.78rem; color:#e8eaf0; font-family:'Inter',sans-serif;
        }
        .comm-tag-input:focus { outline:none; border-color:#6c63ff; }
        .comm-toolbar { display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:space-between; }
        .comm-tool-btn {
            padding:7px 13px; border-radius:8px; font-size:0.78rem; font-weight:500;
            background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.08); color:#6b7280;
            cursor:pointer; transition:all .2s; display:flex; align-items:center; gap:5px;
        }
        .comm-tool-btn:hover  { border-color:#6c63ff; color:#e8eaf0; background:rgba(108,99,255,0.1); }
        .comm-tool-btn.comm-active { border-color:#6c63ff; color:#6c63ff; background:rgba(108,99,255,0.1); }
        .comm-post-btn {
            padding:9px 22px; border-radius:10px; font-size:0.85rem; font-weight:700;
            background:linear-gradient(135deg,#6c63ff,#00d4ff);
            color:#fff; font-family:'Syne',sans-serif; border:none; cursor:pointer;
            transition:all .25s; box-shadow:0 0 18px rgba(108,99,255,0.3);
        }
        .comm-post-btn:hover { opacity:.9; transform:translateY(-1px); box-shadow:0 0 28px rgba(108,99,255,0.5); }
        .comm-img-preview {
            width:100%; max-height:170px; object-fit:cover;
            border-radius:10px; margin-bottom:10px; display:none;
            border:1px solid rgba(255,255,255,0.08);
        }
        .comm-img-preview.show { display:block; }

        /* ‚îÄ‚îÄ Post Card ‚îÄ‚îÄ */
        .comm-post-card {
            background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.08);
            border-radius:16px; margin-bottom:14px; overflow:hidden;
            backdrop-filter:blur(16px); transition:border-color .25s,box-shadow .25s;
            animation:commFadeSlide .3s ease;
        }
        .comm-post-card:hover { border-color:rgba(255,255,255,0.14); box-shadow:0 4px 28px rgba(108,99,255,0.1); }
        .comm-post-head { display:flex; align-items:center; gap:12px; padding:15px 18px 10px; }
        .comm-post-avatar {
            width:38px; height:38px; border-radius:50%; flex-shrink:0;
            background:linear-gradient(135deg,#6c63ff,#ff6b9d);
            display:flex; align-items:center; justify-content:center;
            font-weight:700; font-size:0.88rem; overflow:hidden;
        }
        .comm-post-avatar img { width:100%; height:100%; object-fit:cover; }
        .comm-post-meta { flex:1; }
        .comm-post-author { font-size:0.87rem; font-weight:700; color:#e8eaf0; }
        .comm-post-time   { font-size:0.7rem; color:#6b7280; }
        .comm-post-tags-top { display:flex; gap:5px; flex-wrap:wrap; }
        .comm-p-tag {
            padding:2px 9px; border-radius:20px; font-size:0.67rem; font-weight:600;
            background:rgba(0,212,255,0.1); border:1px solid rgba(0,212,255,0.2); color:#00d4ff;
            cursor:pointer; transition:background .2s;
        }
        .comm-p-tag:hover { background:rgba(0,212,255,0.2); }
        .comm-post-body { padding:0 18px 12px; }
        .comm-post-title { font-size:0.97rem; font-weight:700; font-family:'Syne',sans-serif; margin-bottom:7px; line-height:1.4; color:#e8eaf0; }
        .comm-post-content { font-size:0.84rem; color:rgba(232,234,240,0.72); line-height:1.7; white-space:pre-wrap; }
        .comm-post-image { width:100%; max-height:260px; object-fit:cover; margin:9px 0; border-radius:10px; }
        .comm-post-code {
            background:rgba(0,0,0,0.5); border:1px solid rgba(108,99,255,0.2);
            border-radius:10px; padding:11px 15px; margin:9px 0;
            font-family:'Courier New',monospace; font-size:0.78rem;
            color:#a5b4fc; overflow-x:auto; white-space:pre;
        }
        .comm-post-actions { display:flex; gap:0; border-top:1px solid rgba(255,255,255,0.08); }
        .comm-act-btn {
            flex:1; padding:9px 0; font-size:0.78rem; font-weight:600;
            background:transparent; color:#6b7280; border:none; cursor:pointer;
            transition:all .2s; display:flex; align-items:center; justify-content:center; gap:5px;
            border-right:1px solid rgba(255,255,255,0.08);
        }
        .comm-act-btn:last-child { border-right:none; }
        .comm-act-btn:hover { background:rgba(255,255,255,0.04); color:#e8eaf0; }
        .comm-act-btn.comm-liked { color:#ff6b9d; }

        /* ‚îÄ‚îÄ Comments ‚îÄ‚îÄ */
        .comm-comments-area {
            border-top:1px solid rgba(255,255,255,0.08); padding:12px 18px;
            display:none; background:rgba(0,0,0,0.1);
        }
        .comm-comments-area.open { display:block; }
        .comm-comment-item { display:flex; gap:10px; margin-bottom:10px; animation:commFadeSlide .2s ease; }
        .comm-cmt-ava {
            width:30px; height:30px; border-radius:50%; flex-shrink:0;
            background:linear-gradient(135deg,#00d4ff,#6c63ff);
            display:flex; align-items:center; justify-content:center;
            font-size:0.72rem; font-weight:700; overflow:hidden;
        }
        .comm-cmt-ava img { width:100%; height:100%; object-fit:cover; }
        .comm-cmt-body { flex:1; }
        .comm-cmt-name { font-size:0.72rem; font-weight:700; color:#00d4ff; margin-bottom:2px; }
        .comm-cmt-text {
            font-size:0.8rem; background:rgba(255,255,255,0.04);
            padding:7px 11px; border-radius:0 10px 10px 10px;
            border:1px solid rgba(255,255,255,0.08); line-height:1.5; word-break:break-word;
            color:#e8eaf0;
        }
        .comm-cmt-likes { font-size:0.68rem; color:#6b7280; margin-top:4px; cursor:pointer; transition:color .2s; }
        .comm-cmt-likes:hover { color:#ff6b9d; }
        .comm-add-comment-row { display:flex; gap:8px; margin-top:10px; }
        .comm-cmt-input {
            flex:1; padding:7px 13px; border-radius:10px;
            background:rgba(0,0,0,0.3); border:1px solid rgba(255,255,255,0.08);
            font-size:0.8rem; color:#e8eaf0; transition:border-color .2s;
            font-family:'Inter',sans-serif;
        }
        .comm-cmt-input:focus { border-color:#6c63ff; outline:none; }
        .comm-cmt-send {
            padding:7px 15px; border-radius:10px;
            background:linear-gradient(135deg,#6c63ff,#00d4ff);
            color:#fff; font-size:0.78rem; font-weight:700; border:none; cursor:pointer; transition:all .2s;
        }
        .comm-cmt-send:hover { opacity:.85; }

        /* ‚îÄ‚îÄ Filter bar ‚îÄ‚îÄ */
        .comm-filter-bar { display:flex; gap:7px; flex-wrap:wrap; margin-bottom:18px; }
        .comm-filter-tag {
            padding:5px 14px; border-radius:20px; font-size:0.78rem; font-weight:600;
            background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.08); color:#6b7280;
            cursor:pointer; transition:all .2s;
        }
        .comm-filter-tag:hover, .comm-filter-tag.comm-active {
            background:rgba(108,99,255,0.15); border-color:rgba(108,99,255,0.4); color:#6c63ff;
        }

        /* ‚îÄ‚îÄ Load more ‚îÄ‚îÄ */
        .comm-load-more {
            display:block; width:100%; margin-top:14px;
            padding:11px; border-radius:10px;
            background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.08);
            font-size:0.82rem; font-weight:600; color:#6b7280;
            text-align:center; cursor:pointer; transition:all .2s;
        }
        .comm-load-more:hover { border-color:#6c63ff; color:#e8eaf0; }

        /* ‚îÄ‚îÄ Timeline ‚îÄ‚îÄ */
        .comm-timeline-feed { max-width:660px; margin:0 auto; }
        .comm-tl-item {
            display:flex; gap:14px; margin-bottom:14px;
            padding:15px; border-radius:16px;
            background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.08);
            backdrop-filter:blur(16px); animation:commFadeSlide .3s ease; transition:border-color .2s;
        }
        .comm-tl-item:hover { border-color:rgba(255,255,255,0.14); }
        .comm-tl-icon {
            width:42px; height:42px; border-radius:12px; flex-shrink:0;
            display:flex; align-items:center; justify-content:center; font-size:1.15rem;
        }
        .comm-tl-icon.post   { background:linear-gradient(135deg,rgba(108,99,255,0.2),rgba(0,212,255,0.1)); border:1px solid rgba(108,99,255,0.3); }
        .comm-tl-icon.share  { background:linear-gradient(135deg,rgba(255,107,157,0.15),rgba(255,177,66,0.1)); border:1px solid rgba(255,107,157,0.3); }
        .comm-tl-icon.upload { background:linear-gradient(135deg,rgba(6,255,165,0.1),rgba(0,212,255,0.15)); border:1px solid rgba(6,255,165,0.2); }
        .comm-tl-body { flex:1; }
        .comm-tl-msg { font-size:0.87rem; line-height:1.5; color:#e8eaf0; }
        .comm-tl-msg strong { color:#00d4ff; }
        .comm-tl-time { font-size:0.7rem; color:#6b7280; margin-top:4px; }

        /* ‚îÄ‚îÄ Spinner ‚îÄ‚îÄ */
        .comm-spinner {
            display:inline-block; width:20px; height:20px; border-radius:50%;
            border:2px solid rgba(255,255,255,0.14); border-top-color:#6c63ff;
            animation:commSpin .8s linear infinite;
        }
        @keyframes commSpin { to { transform:rotate(360deg); } }

        /* ‚îÄ‚îÄ Online indicator (community only) ‚îÄ‚îÄ */
        #comm-online-count {
            position:fixed; bottom:24px; left:24px; z-index:990;
            padding:7px 14px; border-radius:20px;
            background:rgba(10,15,28,0.9); backdrop-filter:blur(20px);
            border:1px solid rgba(6,255,165,0.3);
            font-size:0.75rem; font-weight:600; color:#06ffa5;
            display:none; align-items:center; gap:6px;
            box-shadow:0 4px 18px rgba(0,0,0,0.4);
        }
        #comm-online-count.comm-show { display:flex; }
        #comm-online-count::before {
            content:''; width:6px; height:6px; border-radius:50%;
            background:#06ffa5; animation:commPulseLive 2s infinite;
        }

        /* ‚îÄ‚îÄ Community Toast (separate from existing toast) ‚îÄ‚îÄ */
        #comm-toast {
            position:fixed; bottom:24px; right:24px; z-index:9990;
            padding:11px 18px; border-radius:12px;
            background:rgba(10,15,28,0.96); backdrop-filter:blur(20px);
            border:1px solid rgba(255,255,255,0.14);
            font-size:0.83rem; font-weight:500; color:#e8eaf0;
            box-shadow:0 8px 32px rgba(0,0,0,0.5);
            transform:translateY(80px); opacity:0;
            transition:all .3s cubic-bezier(.34,1.56,.64,1);
            display:flex; align-items:center; gap:9px;
        }
        #comm-toast.comm-show { transform:translateY(0); opacity:1; }
        #comm-toast.comm-success { border-color:rgba(6,255,165,0.4); color:#06ffa5; }
        #comm-toast.comm-error   { border-color:rgba(255,107,157,0.4); color:#ff6b9d; }

        /* ‚îÄ‚îÄ Points system info box ‚îÄ‚îÄ */
        .comm-pts-grid {
            display:grid; grid-template-columns:repeat(3,1fr); gap:10px; text-align:center;
        }
        .comm-pts-box {
            padding:14px; background:rgba(255,255,255,0.04);
            border-radius:10px; border:1px solid rgba(255,255,255,0.08);
        }
    </style>
</head>

<body class="flex flex-col min-h-screen relative noise bg-grid">

    <!-- ===== AMBIENT BACKGROUND ===== -->
    <div class="fixed inset-0 -z-10 overflow-hidden pointer-events-none">
        <div class="glow-blob w-[600px] h-[600px] bg-blue-900/20 top-0 -left-32"></div>
        <div class="glow-blob w-[500px] h-[500px] bg-purple-900/15 bottom-0 right-0"></div>
        <div class="glow-blob w-[300px] h-[300px] bg-pink-900/10 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"></div>
    </div>

    <!-- ===== GUEST HEADER ===== -->
    <header id="header-guest" class="fixed top-0 w-full z-50 bg-slate-950/80 backdrop-blur-md border-b border-white/5 transition-all">
        <div class="max-w-7xl mx-auto px-6 h-16 flex justify-between items-center">
            <div class="flex items-center gap-2 cursor-pointer" onclick="renderGuestHome()">
                <div class="bg-gradient-to-br from-blue-500 to-purple-600 p-1.5 rounded-md shadow-lg shadow-blue-900/30">
                    <i class="fa-solid fa-microchip"></i>
                </div>
                <span class="font-display font-bold text-xl tracking-tight">TC3 TECH-HUB</span>
            </div>
            <nav class="hidden md:flex space-x-8">
                <a href="#" onclick="renderGuestHome()" class="hover:text-blue-400 font-medium transition-colors">Trang ch·ªß</a>
                <a href="#" onclick="renderProductStore()" class="text-slate-400 hover:text-white transition-colors">Kho d·ª± √°n</a>
                <a href="#" class="text-slate-400 hover:text-white transition-colors">B·∫£ng x·∫øp h·∫°ng</a>
            </nav>
            <div class="flex gap-3">
                <button onclick="showSection('login-section')" class="px-4 py-2 hover:text-blue-400 font-medium transition-colors">Log in</button>
                <button onclick="showSection('register-section')" class="header-btn-glow bg-gradient-to-r from-blue-600 to-purple-600 px-5 py-2 rounded-full font-bold shadow-lg shadow-blue-900/30 transition-all hover:from-blue-500 hover:to-purple-500">Register</button>
            </div>
        </div>
    </header>

    <!-- ===== USER HEADER ===== -->
    <header id="header-user" class="fixed top-0 w-full z-50 bg-slate-950/90 backdrop-blur-md border-b border-blue-900/20 hidden">
        <div class="max-w-7xl mx-auto px-6 h-16 flex justify-between items-center">
            <div class="flex items-center gap-2 cursor-pointer" onclick="showSection('user-dashboard')">
                <div class="bg-gradient-to-br from-blue-500 to-purple-600 p-1.5 rounded-md shadow-lg shadow-blue-900/30">
                    <i class="fa-solid fa-layer-group"></i>
                </div>
                <span class="font-display font-bold text-xl tracking-tight text-gradient-subtle">TC3 MEMBER</span>
            </div>

            <nav class="hidden md:flex space-x-6 text-sm font-medium">
                <a href="#" id="nav-my-projects" class="text-slate-300 hover:text-white transition-colors" onclick="showSection('user-dashboard'); setActiveNav('nav-my-projects')">D·ª± √°n c·ªßa t√¥i</a>
                <a href="#" id="nav-store" class="text-slate-300 hover:text-white transition-colors" onclick="renderProductStore(); setActiveNav('nav-store')">Kho d·ª± √°n</a>
                <!-- ===== COMMUNITY NAV WITH HOVER DROPDOWN ===== -->
                <div class="comm-nav-wrap">
                    <a href="#" class="text-slate-300 hover:text-white transition-colors"
                       onclick="commRequireLogin() && showCommView('community'); return false;">C·ªông ƒë·ªìng</a>
                    <div class="comm-dropdown">
                        <div class="comm-dd-item" onclick="commRequireLogin() && showCommView('forum')">
                            <span class="comm-dd-icon">üí¨</span>
                            <span class="comm-dd-label">Q&A Forum</span>
                            <span class="comm-dd-desc">H·ªèi ƒë√°p, chia s·∫ª ki·∫øn th·ª©c</span>
                        </div>
                        <div class="comm-dd-item" onclick="commRequireLogin() && showCommView('timeline')">
                            <span class="comm-dd-icon">üì°</span>
                            <span class="comm-dd-label">B·∫£ng Tin</span>
                            <span class="comm-dd-desc">Ho·∫°t ƒë·ªông realtime</span>
                        </div>
                        <div class="comm-dd-item" onclick="commRequireLogin() && showCommView('chat')">
                            <span class="comm-dd-icon">‚ö°</span>
                            <span class="comm-dd-label">Live Chat</span>
                            <span class="comm-dd-desc">Chat ph√≤ng chung</span>
                        </div>
                        <div class="comm-dd-item" onclick="commRequireLogin() && showCommView('leaderboard')">
                            <span class="comm-dd-icon">üèÜ</span>
                            <span class="comm-dd-label">Leaderboard</span>
                            <span class="comm-dd-desc">Top 5 th√°ng n√†y</span>
                        </div>
                        <div class="comm-dd-item" onclick="commRequireLogin() && showCommView('share')">
                            <span class="comm-dd-icon">üöÄ</span>
                            <span class="comm-dd-label">Chia S·∫ª D·ª± √Ån</span>
                            <span class="comm-dd-desc">ƒêƒÉng l√™n c·ªông ƒë·ªìng</span>
                        </div>
                    </div>
                </div>
                <a href="#" class="text-slate-300 hover:text-white transition-colors">Thi ƒëua r√®n luy·ªán</a>
                <a href="#" class="text-slate-300 hover:text-white transition-colors">ƒê·ªôi nh√≥m</a>
            </nav>

            <div class="relative">
                <button onclick="toggleDropdown()" class="flex items-center gap-3 focus:outline-none p-1 rounded-full hover:bg-white/5 transition-all pr-4 border border-transparent hover:border-blue-500/20">
                    <img id="header-avatar" src="" alt="User" class="w-9 h-9 rounded-full object-cover border-2 border-blue-500 shadow-lg shadow-blue-900/30">
                    <span id="header-username" class="font-semibold text-sm hidden sm:block">User</span>
                    <i class="fa-solid fa-chevron-down text-xs text-slate-400 transition-transform" id="dropdown-chevron"></i>
                </button>

                <div id="user-dropdown" class="absolute right-0 mt-3 w-56 bg-[#0f172a] rounded-xl shadow-2xl border border-slate-700 hidden-dropdown dropdown-menu overflow-hidden">
                    <div class="px-4 py-3 border-b border-slate-700/50 bg-gradient-to-r from-blue-900/20 to-purple-900/20">
                        <p class="text-xs text-slate-400 uppercase tracking-wider">T√†i kho·∫£n</p>
                        <p id="dropdown-name" class="font-bold text-white truncate">TC3 User</p>
                    </div>
                    <ul class="py-1">
                        <li>
                            <button onclick="openProfilePage()" class="w-full text-left px-4 py-3 text-sm text-slate-300 hover:bg-blue-600/10 hover:text-blue-400 flex items-center gap-3 transition-colors">
                                <i class="fa-regular fa-id-card w-4"></i> Th√¥ng tin ng∆∞·ªùi d√πng
                            </button>
                        </li>
                        <li>
                            <button onclick="confirmLogout()" class="w-full text-left px-4 py-3 text-sm text-red-400 hover:bg-red-500/10 hover:text-red-300 flex items-center gap-3 transition-colors">
                                <i class="fa-solid fa-arrow-right-from-bracket w-4"></i> ƒêƒÉng xu·∫•t
                            </button>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </header>

    <!-- ===== MAIN CONTENT ===== -->
    <main class="flex-grow pt-24 pb-10 relative w-full">

        <!-- ===== GUEST HOME ===== -->
        <div id="guest-home" class="max-w-5xl mx-auto px-4 text-center w-full section-content py-16">
            <div class="space-y-8">
                <!-- Floating decoratives -->
                <div class="relative inline-block">
                    <div class="float-anim absolute -top-8 -left-16 text-blue-500/20 text-6xl pointer-events-none">‚ú¶</div>
                    <div class="float-anim-2 absolute -top-4 -right-12 text-purple-500/20 text-4xl pointer-events-none">‚óà</div>
                    <div class="float-anim-3 absolute -bottom-8 left-8 text-pink-500/15 text-5xl pointer-events-none">‚¨°</div>

                    <div class="welcome-badge inline-flex items-center gap-2 mb-6">
                        <span class="inline-block w-2 h-2 rounded-full bg-blue-400 shadow-lg shadow-blue-400/50" style="animation: pulse-glow 2s infinite"></span>
                        M·∫°ng l∆∞·ªõi k·∫øt n·ªëi ƒëam m√™ ¬∑ TC3 Class 11A1
                    </div>
                </div>

                <h1 class="text-5xl md:text-7xl font-display font-black text-white leading-tight tracking-tight">
                    N∆°i Bi·∫øn √ù T∆∞·ªüng<br>
                    Th√†nh <span class="text-gradient">S·∫£n Ph·∫©m</span>
                </h1>

                <p class="text-slate-400 text-lg max-w-2xl mx-auto leading-relaxed">
                    Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi Kho T√†ng S·ªë. Kh√°m ph√° c√°c d·ª± √°n s√°ng t·∫°o,<br class="hidden md:block"> chia s·∫ª th√†nh qu·∫£ v√† k·∫øt n·ªëi c√πng c·ªông ƒë·ªìng TC3.
                </p>

                <!-- Stats row -->
                <div class="flex justify-center gap-6 mt-4">
                    <div class="welcome-stat-card text-center">
                        <div class="text-2xl font-display font-bold text-gradient">100+</div>
                        <div class="text-xs text-slate-500 mt-1">D·ª± √°n</div>
                    </div>
                    <div class="welcome-stat-card text-center">
                        <div class="text-2xl font-display font-bold text-gradient">42</div>
                        <div class="text-xs text-slate-500 mt-1">Th√†nh vi√™n</div>
                    </div>
                    <div class="welcome-stat-card text-center">
                        <div class="text-2xl font-display font-bold text-gradient">‚àû</div>
                        <div class="text-xs text-slate-500 mt-1">√ù t∆∞·ªüng</div>
                    </div>
                </div>

                <div class="flex justify-center gap-4 mt-8">
                    <button onclick="renderProductStore()" class="header-btn-glow bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white px-8 py-3.5 rounded-xl font-bold transition-all shadow-lg shadow-blue-600/20 flex items-center gap-2">
                        Kh√°m ph√° ngay <i class="fa-solid fa-arrow-right"></i>
                    </button>
                    <button onclick="showSection('login-section')" class="px-8 py-3.5 rounded-xl font-bold border border-slate-700 hover:border-blue-500/50 hover:bg-blue-500/5 transition-all flex items-center gap-2">
                        <i class="fa-solid fa-user"></i> ƒêƒÉng nh·∫≠p
                    </button>
                </div>
            </div>
        </div>

        <!-- ===== PRODUCT STORE ===== -->
        <div id="product-store" class="hidden w-full max-w-7xl mx-auto px-6 section-content pb-20 pt-10">
            <div class="flex flex-col md:flex-row justify-between items-end mb-10 gap-6">
                <div class="text-left">
                    <div class="welcome-badge inline-flex items-center gap-2 mb-4">
                        <i class="fa-solid fa-cube text-blue-400 text-xs"></i>
                        Kho T√†ng S·ªë
                    </div>
                    <h2 class="text-4xl font-display font-extrabold text-white">Kho D·ª± √Ån <span class="text-gradient">TC3</span></h2>
                    <p class="text-slate-400 mt-2">C√°c s·∫£n ph·∫©m ti√™u bi·ªÉu c·ªßa h·ªçc sinh 11A1.</p>
                </div>
                <div class="relative w-full md:w-96">
                    <div class="relative">
                        <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-slate-500"></i>
                        <input type="text" id="product-search" oninput="handleSearchInput(this.value)" onkeypress="handleSearchEnter(event)"
                            class="w-full bg-slate-900/80 border border-slate-700 rounded-xl py-3.5 pl-12 pr-4 text-white focus:border-blue-500 outline-none transition-all"
                            placeholder="T√¨m t√™n d·ª± √°n ho·∫∑c c√¥ng ngh·ªá...">
                    </div>
                    <div id="search-suggestions" class="search-results"></div>
                </div>
            </div>
            <div id="product-display-grid" class="product-grid"></div>
        </div>

        <!-- ===== LOGIN ===== -->
        <div id="login-section" class="hidden max-w-md w-full mx-auto section-content relative">
            <div class="glass-card p-8 rounded-2xl shadow-2xl">
                <button onclick="renderGuestHome()" class="absolute top-4 right-4 text-slate-500 hover:text-white transition-colors"><i class="fa-solid fa-xmark fa-lg"></i></button>
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center shadow-lg">
                        <i class="fa-solid fa-lock text-sm"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl font-display font-bold text-white">Ch√†o m·ª´ng tr·ªü l·∫°i</h2>
                        <p class="text-slate-400 text-xs">ƒêƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c</p>
                    </div>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs text-slate-400 mb-1 ml-1 font-semibold uppercase tracking-wider">Email</label>
                        <input type="text" id="login-user" class="w-full bg-slate-900/80 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-blue-500 outline-none transition-all">
                    </div>
                    <div>
                        <label class="block text-xs text-slate-400 mb-1 ml-1 font-semibold uppercase tracking-wider">M·∫≠t kh·∫©u</label>
                        <input type="password" id="login-pass" class="w-full bg-slate-900/80 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-blue-500 outline-none transition-all">
                    </div>
                    <button onclick="handleLogin()" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-bold py-3.5 rounded-xl transition-all shadow-lg shadow-blue-900/30 mt-2">ƒêƒÉng Nh·∫≠p</button>
                </div>
                <div class="mt-6 text-center text-sm text-slate-500">
                    Ch∆∞a c√≥ t√†i kho·∫£n? <button onclick="showSection('register-section')" class="text-blue-400 hover:text-blue-300 font-semibold">ƒêƒÉng k√Ω ngay</button>
                </div>
            </div>
        </div>

        <!-- ===== REGISTER ===== -->
        <div id="register-section" class="hidden max-w-md w-full mx-auto section-content relative">
            <div class="glass-card p-8 rounded-2xl shadow-2xl">
                <button onclick="renderGuestHome()" class="absolute top-4 right-4 text-slate-500 hover:text-white transition-colors"><i class="fa-solid fa-xmark fa-lg"></i></button>
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-pink-600 flex items-center justify-center shadow-lg">
                        <i class="fa-solid fa-user-plus text-sm"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl font-display font-bold text-white">T·∫°o t√†i kho·∫£n m·ªõi</h2>
                        <p class="text-slate-400 text-xs">Gia nh·∫≠p c·ªông ƒë·ªìng TC3</p>
                    </div>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs text-slate-400 mb-1 ml-1 font-semibold uppercase tracking-wider">T√™n hi·ªÉn th·ªã</label>
                        <input type="text" id="reg-user" class="w-full bg-slate-900/80 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-blue-500 outline-none transition-all">
                    </div>
                    <div>
                        <label class="block text-xs text-slate-400 mb-1 ml-1 font-semibold uppercase tracking-wider">Email li√™n k·∫øt</label>
                        <input type="email" id="reg-email" class="w-full bg-slate-900/80 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-blue-500 outline-none transition-all">
                    </div>
                    <div>
                        <label class="block text-xs text-slate-400 mb-1 ml-1 font-semibold uppercase tracking-wider">M·∫≠t kh·∫©u</label>
                        <input type="password" id="reg-pass" class="w-full bg-slate-900/80 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-blue-500 outline-none transition-all">
                    </div>
                    <button onclick="handleRegister()" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-bold py-3.5 rounded-xl transition-all shadow-lg mt-2">ƒêƒÉng K√Ω</button>
                </div>
            </div>
        </div>

        <!-- ===== USER DASHBOARD ===== -->
        <div id="user-dashboard" class="hidden w-full max-w-7xl mx-auto px-6 section-content pb-20 pt-6">

            <!-- TOP SECTION -->
            <div class="flex flex-col md:flex-row gap-6 mb-4">

                <!-- LEFT: Create Product -->
                <div class="flex-1 glass-card p-8 rounded-2xl shadow-xl relative overflow-hidden">
                    <!-- Decorative corner glow -->
                    <div class="absolute top-0 right-0 w-48 h-48 bg-blue-600/5 rounded-full blur-3xl pointer-events-none"></div>

                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center">
                            <i class="fa-solid fa-plus text-xs"></i>
                        </div>
                        <h3 class="text-xl font-display font-bold text-white">T·∫°o s·∫£n ph·∫©m m·ªõi</h3>
                    </div>

                    <!-- Upload Box -->
                    <div class="upload-box p-10 flex flex-col items-center justify-center text-center cursor-pointer"
                         onclick="document.getElementById('new-file-input').click()">
                        <div class="plus-btn mb-4">
                            <i class="fa-solid fa-plus text-2xl text-white"></i>
                        </div>
                        <span class="text-slate-300 font-semibold text-base">Nh·∫•n ƒë·ªÉ t·∫£i file l√™n</span>
                        <div class="flex items-center gap-2 mt-3">
                            <span class="text-xs bg-blue-900/40 text-blue-300 border border-blue-500/20 px-2.5 py-1 rounded-full font-medium">.SB3</span>
                            <span class="text-xs text-slate-600">¬∑</span>
                            <span class="text-xs bg-purple-900/40 text-purple-300 border border-purple-500/20 px-2.5 py-1 rounded-full font-medium">.PDF</span>
                        </div>
                        <input type="file" id="new-file-input" accept=".sb3, .pdf" class="hidden" onchange="handleNewFileSelect(event)">
                    </div>
                </div>

                <!-- RIGHT: Welcome Card -->
                <div class="flex-1 relative overflow-hidden rounded-2xl">
                    <div class="welcome-card h-full p-8 flex flex-col justify-between relative">
                        <!-- Floating decorative elements -->
                        <div class="absolute top-4 right-4 float-anim opacity-10 pointer-events-none">
                            <i class="fa-solid fa-microchip text-blue-400 text-5xl"></i>
                        </div>
                        <div class="absolute bottom-8 right-16 float-anim-2 opacity-8 pointer-events-none">
                            <i class="fa-solid fa-code text-purple-400 text-3xl"></i>
                        </div>
                        <div class="absolute top-1/2 right-8 float-anim-3 opacity-8 pointer-events-none">
                            <i class="fa-solid fa-star text-pink-400 text-xl"></i>
                        </div>

                        <!-- Deco rings -->
                        <div class="deco-ring w-32 h-32 absolute -bottom-8 -left-8 opacity-30"></div>
                        <div class="deco-ring w-20 h-20 absolute top-12 left-1/3 opacity-20"></div>

                        <div>
                            <div class="welcome-badge inline-flex items-center gap-2 mb-4">
                                <span class="inline-block w-1.5 h-1.5 rounded-full bg-green-400" style="animation: pulse-glow 2s infinite"></span>
                                Online ¬∑ TC3 TECH-HUB
                            </div>
                            <h3 class="text-3xl font-display font-black text-white leading-tight mb-3">
                                Ch√†o m·ª´ng, <span id="welcome-username" class="text-gradient"></span>!
                            </h3>
                            <p class="text-slate-400 text-sm leading-relaxed max-w-sm">
                                ƒê√¢y l√† kh√¥ng gian s√°ng t·∫°o c·ªßa ri√™ng b·∫°n. H√£y t·∫£i l√™n d·ª± √°n Scratch ho·∫∑c PDF ƒë·ªÉ chia s·∫ª c√πng c·ªông ƒë·ªìng TC3.
                            </p>
                        </div>

                        <div class="flex gap-3 mt-6">
                            <div class="welcome-stat-card flex-1 text-center">
                                <div id="user-project-count" class="text-xl font-display font-bold text-gradient">0</div>
                                <div class="text-xs text-slate-500 mt-0.5">D·ª± √°n c·ªßa b·∫°n</div>
                            </div>
                            <div class="welcome-stat-card flex-1 text-center">
                                <div class="text-xl font-display font-bold text-gradient">TC3</div>
                                <div class="text-xs text-slate-500 mt-0.5">C·ªông ƒë·ªìng</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- DIVIDER -->
            <div class="gradient-divider my-10"></div>

            <!-- BOTTOM SECTION: My Products -->
            <div>
                <div class="flex items-center justify-between mb-8">
                    <h2 class="text-3xl font-display font-extrabold text-white flex items-center gap-3">
                        <span class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500/20 to-purple-500/20 border border-blue-500/20 flex items-center justify-center">
                            <i class="fa-solid fa-folder-open text-blue-400 text-base"></i>
                        </span>
                        S·∫£n ph·∫©m c·ªßa t√¥i
                    </h2>
                    <div class="text-xs text-slate-600 uppercase tracking-wider font-semibold">ƒê∆∞·ª£c l∆∞u tr√™n Firebase</div>
                </div>
                <div id="my-personal-projects-grid" class="product-grid">
                    <div class="col-span-full text-center py-20 bg-slate-900/20 rounded-2xl border border-dashed border-slate-800/50 text-slate-600">
                        <i class="fa-solid fa-inbox text-3xl mb-3 block opacity-50"></i>
                        B·∫°n ch∆∞a c√≥ s·∫£n ph·∫©m n√†o. H√£y nh·∫•n d·∫•u c·ªông ·ªü tr√™n ƒë·ªÉ b·∫Øt ƒë·∫ßu!
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== PROFILE PAGE ===== -->
        <div id="profile-page" class="hidden w-full max-w-4xl mx-auto px-4 py-8 section-content">
            <div class="glass-card border border-slate-800 rounded-2xl overflow-hidden shadow-2xl">
                <div class="h-32 bg-gradient-to-r from-blue-900 to-purple-900 relative">
                    <div class="absolute inset-0 bg-grid opacity-30"></div>
                    <button onclick="showSection('user-dashboard')" class="absolute top-4 left-4 bg-black/30 hover:bg-black/50 text-white px-3 py-1 rounded-lg backdrop-blur-sm text-sm transition-all">
                        <i class="fa-solid fa-arrow-left mr-1"></i> Quay l·∫°i
                    </button>
                </div>
                <div class="px-8 pb-8">
                    <div class="relative -mt-12 mb-6 flex flex-col md:flex-row items-end md:items-center gap-6">
                        <img id="profile-current-avatar" src="" class="w-24 h-24 rounded-full border-4 border-[#0f172a] bg-slate-800 shadow-xl object-cover">
                        <div class="flex-1">
                            <h2 class="text-2xl font-display font-bold text-white">Ch·ªânh s·ª≠a h·ªì s∆°</h2>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="md:col-span-1 space-y-4">
                            <h3 class="font-semibold text-slate-300 border-b border-slate-800/50 pb-2">Ch·ªçn Avatar</h3>
                            <div class="grid grid-cols-3 gap-3" id="avatar-grid"></div>
                        </div>
                        <div class="md:col-span-2 space-y-4">
                            <div>
                                <label class="text-xs text-slate-500 uppercase font-bold tracking-wider">T√™n ng∆∞·ªùi d√πng</label>
                                <input type="text" id="edit-name" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl p-3 text-white mt-1 focus:border-blue-500 outline-none transition-all">
                            </div>
                            <div>
                                <label class="text-xs text-slate-500 uppercase font-bold tracking-wider">Email</label>
                                <input type="email" id="edit-email" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl p-3 text-white mt-1 focus:border-blue-500 outline-none transition-all">
                            </div>
                            <div>
                                <label class="text-xs text-slate-500 uppercase font-bold tracking-wider">M·∫≠t kh·∫©u m·ªõi</label>
                                <input type="password" id="edit-password" placeholder="ƒê·ªÉ tr·ªëng n·∫øu kh√¥ng ƒë·ªïi" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl p-3 text-white mt-1 focus:border-blue-500 outline-none transition-all">
                            </div>
                            <div>
                                <label class="text-xs text-slate-500 uppercase font-bold tracking-wider">X√°c nh·∫≠n m·∫≠t kh·∫©u</label>
                                <input type="password" id="edit-password-confirm" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl p-3 text-white mt-1 focus:border-blue-500 outline-none transition-all">
                            </div>
                            <div class="pt-4 flex justify-end gap-3">
                                <button onclick="preSaveCheck()" class="px-6 py-2.5 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white rounded-xl font-bold shadow-lg transition-all">L∆∞u thay ƒë·ªïi</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===================================================================
             COMMUNITY SECTION (all sub-views, hidden until user logs in)
             All IDs and classes prefixed with "comm-" to avoid conflicts
        ==================================================================== -->
        <div id="community-section" class="hidden section-content comm-root">

            <!-- ‚îÄ‚îÄ Back to Dashboard quick link ‚îÄ‚îÄ -->
            <button class="comm-back-btn" onclick="showSection('user-dashboard'); setActiveNav('nav-my-projects')">
                ‚Üê Quay v·ªÅ Dashboard
            </button>

            <!-- ‚ïê‚ïê VIEW: COMMUNITY HOME (2-column) ‚ïê‚ïê -->
            <div id="comm-view-community" class="comm-view comm-active">
                <div class="comm-section-header">
                    <span class="comm-section-title">üåê C·ªông ƒê·ªìng</span>
                    <div class="comm-badge-live">LIVE</div>
                </div>
                <div class="comm-layout">

                    <!-- LEFT: Leaderboard mini + Mini Chat -->
                    <div>
                        <div class="comm-card" style="margin-bottom:18px">
                            <div class="comm-card-title">üèÜ <span>Leaderboard Th√°ng N√†y</span></div>
                            <div id="comm-lb-mini"></div>
                            <button class="comm-load-more" onclick="showCommView('leaderboard')" style="margin-top:6px">Xem ƒë·∫ßy ƒë·ªß ‚Üí</button>
                        </div>
                        <div class="comm-card">
                            <div class="comm-card-title" style="justify-content:space-between">
                                <span style="display:flex;align-items:center;gap:8px">‚ö° <span>Live Chat</span></span>
                                <div class="comm-badge-live" style="font-size:0.63rem">LIVE</div>
                            </div>
                            <div class="comm-chat-box" id="comm-mini-chat-box"></div>
                            <div class="comm-chat-input-row">
                                <input class="comm-chat-input" id="comm-mini-chat-input" placeholder="Nh·∫Øn g√¨ ƒë√≥..." onkeydown="if(event.key==='Enter')commSendMiniChat()"/>
                                <button class="comm-chat-send" onclick="commSendMiniChat()">‚Üí</button>
                            </div>
                        </div>
                    </div>

                    <!-- RIGHT: Composer + Feed -->
                    <div>
                        <div class="comm-composer">
                            <div class="comm-composer-title">‚úçÔ∏è ƒêƒÉng b√†i m·ªõi</div>
                            <input class="comm-compose-input" id="comm-c-title" placeholder="Ti√™u ƒë·ªÅ b√†i vi·∫øt..."/>
                            <textarea class="comm-compose-area" id="comm-c-content" placeholder="N·ªôi dung, c√¢u h·ªèi, ho·∫∑c chia s·∫ª c·ªßa b·∫°n..."></textarea>
                            <img id="comm-c-img-preview" class="comm-img-preview" alt="preview"/>
                            <textarea class="comm-compose-code" id="comm-c-code" placeholder="// Code snippet (t√πy ch·ªçn)"></textarea>
                            <div class="comm-tags-row" id="comm-tags-row">
                                <span style="font-size:0.75rem;color:#6b7280;font-weight:600">#</span>
                                <input class="comm-tag-input" id="comm-tag-input" placeholder="Th√™m tag... Enter" onkeydown="commAddTag(event)"/>
                            </div>
                            <div class="comm-toolbar">
                                <div style="display:flex;gap:8px;flex-wrap:wrap">
                                    <label class="comm-tool-btn">
                                        üì∑ ·∫¢nh
                                        <input type="file" accept="image/*" style="display:none" onchange="commPreviewImg(event)"/>
                                    </label>
                                    <button class="comm-tool-btn" id="comm-code-toggle" onclick="commToggleCode()">üíª Code</button>
                                </div>
                                <button class="comm-post-btn" onclick="commSubmitPost()">üöÄ ƒêƒÉng B√†i</button>
                            </div>
                        </div>
                        <div class="comm-filter-bar" id="comm-filter-bar">
                            <button class="comm-filter-tag comm-active" onclick="commFilterPosts(null,this)">T·∫•t c·∫£</button>
                            <button class="comm-filter-tag" onclick="commFilterPosts('js',this)">JavaScript</button>
                            <button class="comm-filter-tag" onclick="commFilterPosts('python',this)">Python</button>
                            <button class="comm-filter-tag" onclick="commFilterPosts('scratch',this)">Scratch</button>
                            <button class="comm-filter-tag" onclick="commFilterPosts('question',this)">‚ùì H·ªèi ƒë√°p</button>
                            <button class="comm-filter-tag" onclick="commFilterPosts('share',this)">üîó Chia s·∫ª</button>
                        </div>
                        <div id="comm-post-feed"></div>
                        <button class="comm-load-more" id="comm-load-more-btn" onclick="commLoadMorePosts()" style="display:none">T·∫£i th√™m b√†i vi·∫øt</button>
                    </div>
                </div>
            </div>

            <!-- ‚ïê‚ïê VIEW: FORUM ‚ïê‚ïê -->
            <div id="comm-view-forum" class="comm-view">
                <div class="comm-section-header">
                    <span class="comm-section-title">üí¨ Q&A Forum</span>
                    <div class="comm-badge-live">LIVE</div>
                </div>
                <div class="comm-filter-bar" id="comm-forum-filter-bar">
                    <button class="comm-filter-tag comm-active" onclick="commFilterForumPosts(null,this)">T·∫•t c·∫£</button>
                    <button class="comm-filter-tag" onclick="commFilterForumPosts('js',this)">JavaScript</button>
                    <button class="comm-filter-tag" onclick="commFilterForumPosts('python',this)">Python</button>
                    <button class="comm-filter-tag" onclick="commFilterForumPosts('scratch',this)">Scratch</button>
                    <button class="comm-filter-tag" onclick="commFilterForumPosts('question',this)">‚ùì H·ªèi ƒë√°p</button>
                </div>
                <div id="comm-forum-feed"></div>
            </div>

            <!-- ‚ïê‚ïê VIEW: TIMELINE ‚ïê‚ïê -->
            <div id="comm-view-timeline" class="comm-view">
                <div class="comm-section-header">
                    <span class="comm-section-title">üì° B·∫£ng Tin Ho·∫°t ƒê·ªông</span>
                    <div class="comm-badge-live">REALTIME</div>
                </div>
                <div class="comm-timeline-feed" id="comm-timeline-feed">
                    <div style="text-align:center;padding:40px;color:#6b7280">
                        <div class="comm-spinner"></div>
                        <p style="margin-top:12px;font-size:0.85rem">ƒêang t·∫£i ho·∫°t ƒë·ªông...</p>
                    </div>
                </div>
            </div>

            <!-- ‚ïê‚ïê VIEW: LIVE CHAT ‚ïê‚ïê -->
            <div id="comm-view-chat" class="comm-view">
                <div class="comm-section-header">
                    <span class="comm-section-title">‚ö° Live Chat ‚Äî Ph√≤ng Chung</span>
                    <div class="comm-badge-live">LIVE</div>
                </div>
                <div class="comm-chat-full">
                    <div class="comm-chat-full-box" id="comm-chat-full-box"></div>
                    <div class="comm-chat-full-input-row">
                        <input class="comm-chat-full-input" id="comm-chat-full-input"
                               placeholder="Nh·∫Øn g√¨ ƒë√≥ v·ªõi c·∫£ l·ªõp... (Enter ƒë·ªÉ g·ª≠i)"
                               onkeydown="if(event.key==='Enter')commSendFullChat()"/>
                        <button class="comm-chat-full-send" onclick="commSendFullChat()">G·ª≠i ‚Üí</button>
                    </div>
                </div>
            </div>

            <!-- ‚ïê‚ïê VIEW: LEADERBOARD ‚ïê‚ïê -->
            <div id="comm-view-leaderboard" class="comm-view">
                <div class="comm-section-header">
                    <span class="comm-section-title">üèÜ B·∫£ng X·∫øp H·∫°ng</span>
                    <span style="font-size:0.8rem;color:#6b7280" id="comm-lb-month-label"></span>
                </div>
                <div style="max-width:660px;margin:0 auto" id="comm-lb-full-list">
                    <div style="text-align:center;padding:40px;color:#6b7280">
                        <div class="comm-spinner"></div>
                        <p style="margin-top:12px;font-size:0.85rem">ƒêang t·∫£i...</p>
                    </div>
                </div>
                <div style="max-width:660px;margin:18px auto 0" class="comm-card">
                    <div class="comm-card-title">üìä <span>H·ªá th·ªëng ƒëi·ªÉm</span></div>
                    <div class="comm-pts-grid">
                        <div class="comm-pts-box">
                            <div style="font-size:1.4rem;margin-bottom:5px">‚úçÔ∏è</div>
                            <div style="font-size:1.15rem;font-weight:800;font-family:'Syne',sans-serif;color:#6c63ff">+5</div>
                            <div style="font-size:0.72rem;color:#6b7280">ƒêƒÉng b√†i</div>
                        </div>
                        <div class="comm-pts-box">
                            <div style="font-size:1.4rem;margin-bottom:5px">üí¨</div>
                            <div style="font-size:1.15rem;font-weight:800;font-family:'Syne',sans-serif;color:#00d4ff">+2</div>
                            <div style="font-size:0.72rem;color:#6b7280">Comment</div>
                        </div>
                        <div class="comm-pts-box">
                            <div style="font-size:1.4rem;margin-bottom:5px">‚ù§Ô∏è</div>
                            <div style="font-size:1.15rem;font-weight:800;font-family:'Syne',sans-serif;color:#ff6b9d">+1</div>
                            <div style="font-size:0.72rem;color:#6b7280">Nh·∫≠n like</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ‚ïê‚ïê VIEW: SHARE PROJECT ‚ïê‚ïê -->
            <div id="comm-view-share" class="comm-view">
                <div class="comm-section-header">
                    <span class="comm-section-title">üöÄ Chia S·∫ª D·ª± √Ån</span>
                </div>
                <div style="max-width:580px;margin:0 auto" class="comm-card">
                    <div class="comm-card-title">üì¶ <span>Ch·ªçn d·ª± √°n ƒë·ªÉ chia s·∫ª</span></div>
                    <div id="comm-share-project-list">
                        <div style="text-align:center;color:#6b7280;padding:30px;font-size:0.85rem">ƒêang t·∫£i d·ª± √°n c·ªßa b·∫°n...</div>
                    </div>
                </div>
            </div>

        </div><!-- /#community-section -->

    </main>

    <!-- ===== FOOTER ===== -->
    <footer id="main-footer" class="border-t border-slate-800/30 bg-[#03060d] py-8 mt-auto">
        <div class="text-center text-xs text-slate-700 tracking-widest uppercase font-semibold">
            ¬© 2024 TC3 TECH-HUB ¬∑ Developed with <span class="text-red-900">‚ô•</span> by 11A1
        </div>
    </footer>

    <!-- ===================================================================
         MODALS
    ==================================================================== -->

    <!-- LOGOUT MODAL -->
    <div id="logout-modal" class="fixed inset-0 z-[60] flex items-center justify-center hidden">
        <div class="modal-overlay absolute inset-0" onclick="closeModal('logout-modal')"></div>
        <div class="glass-card rounded-2xl p-6 max-w-sm w-full mx-4 relative z-10 border border-slate-700 shadow-2xl">
            <div class="text-center">
                <div class="w-12 h-12 rounded-full bg-red-500/10 border border-red-500/20 flex items-center justify-center mx-auto mb-4">
                    <i class="fa-solid fa-arrow-right-from-bracket text-red-400"></i>
                </div>
                <h3 class="text-lg font-bold text-white mb-2">B·∫°n mu·ªën ƒëƒÉng xu·∫•t?</h3>
                <p class="text-slate-500 text-sm mb-6">B·∫°n s·∫Ω c·∫ßn ƒëƒÉng nh·∫≠p l·∫°i ƒë·ªÉ ti·∫øp t·ª•c.</p>
                <div class="flex gap-3 justify-center">
                    <button onclick="closeModal('logout-modal')" class="px-5 py-2.5 bg-slate-700 hover:bg-slate-600 text-white rounded-xl transition-all font-medium">H·ªßy</button>
                    <button onclick="performLogout()" class="px-5 py-2.5 bg-red-600 hover:bg-red-500 text-white rounded-xl transition-all font-bold">ƒêƒÉng xu·∫•t</button>
                </div>
            </div>
        </div>
    </div>

    <!-- SAVE PROFILE MODAL -->
    <div id="save-modal" class="fixed inset-0 z-[60] flex items-center justify-center hidden">
        <div class="modal-overlay absolute inset-0"></div>
        <div class="glass-card rounded-2xl p-6 max-w-sm w-full mx-4 relative z-10 border border-slate-700 shadow-2xl text-center">
            <h3 class="text-lg font-bold text-white mb-4">X√°c nh·∫≠n l∆∞u thay ƒë·ªïi?</h3>
            <div class="flex gap-3 justify-center">
                <button onclick="closeModal('save-modal')" class="px-5 py-2.5 bg-slate-700 hover:bg-slate-600 text-white rounded-xl transition-all font-medium">H·ªßy</button>
                <button onclick="performSaveProfile()" class="px-5 py-2.5 bg-blue-600 hover:bg-blue-500 text-white rounded-xl transition-all font-bold">X√°c nh·∫≠n</button>
            </div>
        </div>
    </div>

    <!-- ===================================================================
         UPLOAD LOADING OVERLAY (required by my-projects-v2.js)
    ==================================================================== -->
    <div id="upload-loading-overlay" class="fixed inset-0 z-[80] items-center justify-center hidden flex-col gap-6">
        <!-- Animated background -->
        <div class="absolute inset-0 bg-grid opacity-20"></div>
        <div class="glow-blob w-[400px] h-[400px] bg-blue-900/30 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"></div>

        <div class="relative z-10 flex flex-col items-center gap-8">
            <!-- Ring spinner -->
            <div class="relative">
                <div class="loading-ring"></div>
                <div class="absolute inset-3 rounded-full border border-purple-500/20 border-dashed" style="animation: spin-slow 3s linear infinite reverse"></div>
                <div class="absolute inset-0 flex items-center justify-center">
                    <i class="fa-solid fa-file-arrow-up text-blue-400 text-xl"></i>
                </div>
            </div>

            <!-- Text -->
            <div class="text-center">
                <h3 class="text-xl font-display font-bold text-white mb-2">ƒêang ph√¢n t√≠ch file...</h3>
                <p class="text-slate-500 text-sm" id="loading-status-text">Vui l√≤ng ƒë·ª£i trong gi√¢y l√°t</p>
            </div>

            <!-- Progress bar -->
            <div class="w-64 h-1 bg-slate-800 rounded-full overflow-hidden">
                <div class="loading-progress h-full w-full"></div>
            </div>

            <!-- File type badges -->
            <div class="flex gap-3">
                <span class="text-xs bg-blue-900/40 text-blue-300 border border-blue-500/20 px-3 py-1.5 rounded-full">.SB3 Scratch</span>
                <span class="text-xs bg-purple-900/40 text-purple-300 border border-purple-500/20 px-3 py-1.5 rounded-full">.PDF Document</span>
            </div>
        </div>
    </div>

    <!-- ===================================================================
         PREVIEW MODAL (required by my-projects-v2.js)
    ==================================================================== -->
    <div id="preview-modal" class="fixed inset-0 z-[80] items-center justify-center hidden">
        <!-- Background -->
        <div class="absolute inset-0 bg-grid opacity-10"></div>
        <div class="glow-blob w-[500px] h-[500px] bg-blue-900/20 absolute top-0 left-0"></div>
        <div class="glow-blob w-[400px] h-[400px] bg-purple-900/15 absolute bottom-0 right-0"></div>

        <!-- Modal Content -->
        <div class="relative z-10 w-full max-w-6xl mx-4 flex flex-col h-[90vh] max-h-[90vh]">

            <!-- Modal Header -->
            <div class="flex items-center justify-between px-6 py-4 border-b border-slate-800/50">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center">
                        <i class="fa-solid fa-eye text-xs"></i>
                    </div>
                    <span class="font-display font-bold text-white text-lg">Xem tr∆∞·ªõc & Xu·∫•t b·∫£n</span>
                    <span class="text-xs bg-blue-900/40 text-blue-300 border border-blue-500/20 px-2 py-0.5 rounded-full" id="preview-file-type-badge">SB3</span>
                </div>
                <button onclick="closePreviewModal()" class="w-8 h-8 rounded-lg bg-slate-800 hover:bg-slate-700 flex items-center justify-center transition-colors text-slate-400 hover:text-white">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>

            <!-- Modal Body: Left + Right -->
            <div class="flex flex-col md:flex-row flex-1 overflow-hidden gap-0">

                <!-- LEFT PANEL: Product Info -->
                <div class="preview-panel w-full md:w-72 flex-shrink-0 p-5 flex flex-col gap-4 overflow-y-auto m-4 mr-0">
                    <div>
                        <div class="text-xs text-slate-500 uppercase font-bold tracking-wider mb-3">S·∫£n ph·∫©m c·ªßa t√¥i</div>
                        <div class="text-xs text-slate-600 mb-2 flex items-center gap-1.5">
                            <i class="fa-solid fa-file text-blue-400/60"></i>
                            <span id="preview-file-name" class="truncate">filename.sb3</span>
                        </div>
                    </div>

                    <!-- Thumbnail -->
                    <div>
                        <div class="text-xs text-slate-500 uppercase font-semibold tracking-wider mb-2">·∫¢nh minh h·ªça <span class="text-red-400">*</span></div>
                        <div class="thumbnail-upload-zone relative overflow-hidden"
                             onclick="document.getElementById('thumbnail-input').click()">
                            <img id="preview-thumbnail"
                                 src="https://via.placeholder.com/300x200?text=Ch∆∞a+c√≥+·∫£nh"
                                 class="w-full h-36 object-cover rounded-xl"
                                 alt="Thumbnail">
                            <div class="absolute inset-0 flex items-center justify-center bg-black/50 opacity-0 hover:opacity-100 transition-opacity rounded-xl">
                                <div class="text-center">
                                    <i class="fa-solid fa-camera text-white text-xl mb-1 block"></i>
                                    <span class="text-white text-xs font-medium">Thay ·∫£nh</span>
                                </div>
                            </div>
                        </div>
                        <input type="file" id="thumbnail-input" accept=".jpg,.jpeg,.png" class="hidden" onchange="handleThumbnailSelect(event)">
                        <p class="text-xs text-slate-600 mt-1.5">Ch·ªâ ch·∫•p nh·∫≠n .jpg v√† .png</p>
                    </div>

                    <!-- Product Name -->
                    <div>
                        <label class="text-xs text-slate-500 uppercase font-semibold tracking-wider block mb-2">T√™n s·∫£n ph·∫©m <span class="text-red-400">*</span></label>
                        <input type="text" id="preview-name"
                               class="w-full bg-slate-900/80 border border-slate-700 rounded-xl px-3 py-2.5 text-white text-sm focus:border-blue-500 outline-none transition-all"
                               placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m...">
                    </div>

                    <!-- Author (readonly) -->
                    <div>
                        <label class="text-xs text-slate-500 uppercase font-semibold tracking-wider block mb-2">T√°c gi·∫£</label>
                        <div class="flex items-center gap-2 bg-slate-900/50 border border-slate-800 rounded-xl px-3 py-2.5">
                            <i class="fa-solid fa-user text-blue-400 text-xs"></i>
                            <input type="text" id="preview-author" readonly
                                   class="bg-transparent text-slate-300 text-sm outline-none flex-1 cursor-default">
                        </div>
                    </div>

                    <!-- Upload Button -->
                    <div class="mt-auto pt-2">
                        <button onclick="uploadProjectToFirebase()" class="upload-btn-main w-full flex items-center justify-center gap-2">
                            <i class="fa-solid fa-cloud-arrow-up"></i>
                            Xu·∫•t b·∫£n l√™n TC3
                        </button>
                        <p class="text-xs text-slate-600 text-center mt-2">S·∫£n ph·∫©m s·∫Ω hi·ªÉn th·ªã trong Kho d·ª± √°n</p>
                    </div>
                </div>

                <!-- RIGHT PANEL: Demo -->
                <div class="flex-1 p-4 flex flex-col gap-3 overflow-hidden">
                    <div class="flex items-center gap-2">
                        <div class="w-2 h-2 rounded-full bg-blue-400"></div>
                        <span class="text-xs text-slate-500 uppercase font-semibold tracking-wider">B·∫£n xem tr∆∞·ªõc</span>
                    </div>
                    <div id="demo-container" class="demo-frame flex-1 flex items-center justify-center min-h-0">
                        <div class="text-center text-slate-600">
                            <i class="fa-solid fa-play-circle text-4xl mb-3 block opacity-30"></i>
                            <p class="text-sm">ƒêang t·∫£i b·∫£n demo...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===================================================================
         UPLOAD SUCCESS OVERLAY
    ==================================================================== -->
    <div id="success-overlay" class="fixed inset-0 z-[90] flex items-center justify-center hidden">
        <div class="absolute inset-0 bg-grid opacity-10"></div>
        <div class="glow-blob w-[400px] h-[400px] bg-green-900/20 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"></div>
        <div class="relative z-10 text-center success-pop">
            <div class="success-icon-ring mx-auto mb-6">
                <div class="w-16 h-16 rounded-full bg-green-500/20 flex items-center justify-center">
                    <i class="fa-solid fa-check text-3xl text-green-400"></i>
                </div>
            </div>
            <h2 class="text-3xl font-display font-black text-white mb-3">Xu·∫•t b·∫£n th√†nh c√¥ng!</h2>
            <p class="text-slate-400 text-sm mb-2">S·∫£n ph·∫©m c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c t·∫£i l√™n h·ªá th·ªëng.</p>
            <p class="text-slate-600 text-xs">ƒêang chuy·ªÉn h∆∞·ªõng...</p>

            <!-- Confetti dots -->
            <div class="absolute inset-0 pointer-events-none overflow-hidden" id="confetti-container"></div>
        </div>
    </div>

    <!-- ===== COMMUNITY: Online indicator ===== -->
    <div id="comm-online-count">1 online</div>
    <!-- ===== COMMUNITY: Toast (separate from original) ===== -->
    <div id="comm-toast"></div>

    <!-- ===== TOAST ===== -->
    <div id="toast" class="fixed top-24 right-5 px-4 py-3 rounded-xl shadow-xl transform translate-x-[150%] transition-transform duration-300 z-[70] flex items-center gap-3">
        <i class="fa-solid fa-circle-check text-green-400"></i>
        <span id="toast-msg" class="text-sm font-medium">Th√¥ng b√°o</span>
    </div>


    <!-- ===================================================================
         CORE SCRIPTS (preserved from original)
    ==================================================================== -->
    <script>
        const AVATARS = [
            'https://api.dicebear.com/7.x/avataaars/svg?seed=Felix',
            'https://api.dicebear.com/7.x/avataaars/svg?seed=Aneka',
            'https://api.dicebear.com/7.x/avataaars/svg?seed=Bob',
            'https://api.dicebear.com/7.x/avataaars/svg?seed=Jack',
            'https://api.dicebear.com/7.x/avataaars/svg?seed=Milo',
            'https://api.dicebear.com/7.x/avataaars/svg?seed=Saitama'
        ];

        const SAMPLE_PRODUCTS = [
            { id: 1, name: "Web Portfolio C√° Nh√¢n", category: "Ph√°t tri·ªÉn Web", desc: "Trang web gi·ªõi thi·ªáu b·∫£n th√¢n c·ª±c ƒë·∫πp v·ªõi hi·ªáu ·ª©ng chuy·ªÉn ƒë·ªông.", tech: "HTML, CSS, JS", image: 'https://images.unsplash.com/photo-1461749280684-dccba630e2f6?w=400&q=80' },
            { id: 2, name: "App Ghi Ch√∫ Th√¥ng Minh", category: "·ª®ng d·ª•ng", desc: "·ª®ng d·ª•ng gi√∫p b·∫°n qu·∫£n l√Ω c√¥ng vi·ªác v√† ghi ch√∫ h·∫±ng ng√†y.", tech: "ReactJS, Firebase", image: 'https://images.unsplash.com/photo-1512486130939-2c4f79935e4f?w=400&q=80' },
            { id: 3, name: "H·ªá Th·ªëng Nh√† Th√¥ng Minh", category: "IoT", desc: "ƒêi·ªÅu khi·ªÉn ƒë√®n v√† thi·∫øt b·ªã trong nh√† qua ƒëi·ªán tho·∫°i.", tech: "Arduino, ESP32", image: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=400&q=80' },
            { id: 4, name: "Robot T·ª± H√†nh Tr√°nh V·∫≠t C·∫£n", category: "Ph·∫ßn c·ª©ng", desc: "Xe robot t·ª± ƒë·ªông t√¨m ƒë∆∞·ªùng ƒëi trong m√™ cung.", tech: "C++, Arduino", image: 'https://images.unsplash.com/photo-1531746790731-6c087fecd65a?w=400&q=80' },
            { id: 5, name: "Chatbot AI H·ªó Tr·ª£ H·ªçc T·∫≠p", category: "Tr√≠ tu·ªá nh√¢n t·∫°o", desc: "Robot tr·∫£ l·ªùi c√¢u h·ªèi b√†i t·∫≠p t·ª± ƒë·ªông d·ª±a tr√™n GPT.", tech: "Python, OpenAI", image: 'https://images.unsplash.com/photo-1677442136019-21780ecad995?w=400&q=80' },
            { id: 6, name: "Game 2D V∆∞·ª£t Ch∆∞·ªõng Ng·∫°i V·∫≠t", category: "Tr√≤ ch∆°i", desc: "Tr√≤ ch∆°i gi·∫£i tr√≠ vui nh·ªôn v·ªõi nhi·ªÅu c·∫•p ƒë·ªô kh√≥ kh√°c nhau.", tech: "Unity, C#", image: 'https://images.unsplash.com/photo-1550745165-9bc0b252726f?w=400&q=80' }
        ];

        let tempSelectedAvatar = '';

        document.addEventListener('DOMContentLoaded', () => {
            // Will be overridden by Firebase auth listener
            checkLoginState();
        });

        function setActiveNav(id) {
            document.querySelectorAll('#header-user nav a').forEach(a => a.classList.remove('active-nav'));
            const el = document.getElementById(id);
            if (el) el.classList.add('active-nav');
        }

        function showSection(id) {
            document.querySelectorAll('.section-content').forEach(el => el.classList.add('hidden'));
            const target = document.getElementById(id);
            if (target) {
                target.classList.remove('hidden');
                // Re-trigger animation
                target.style.animation = 'none';
                requestAnimationFrame(() => { target.style.animation = ''; });
            }
            const dd = document.getElementById('user-dropdown');
            if (dd) { dd.classList.add('hidden-dropdown'); dd.classList.remove('visible-dropdown'); }
            if (id === 'product-store') renderProducts();
            if (id === 'user-dashboard') {
                renderMyProjects();
                setActiveNav('nav-my-projects');
            }
            // Show/hide community online indicator
            const onlineCount = document.getElementById('comm-online-count');
            if (onlineCount) {
                if (id === 'community-section') {
                    onlineCount.classList.add('comm-show');
                } else {
                    onlineCount.classList.remove('comm-show');
                }
            }
        }

        function renderProductStore() {
            showSection('product-store');
            setActiveNav('nav-store');
        }

        function renderGuestHome() {
            document.getElementById('header-guest').classList.remove('hidden');
            document.getElementById('header-user').classList.add('hidden');
            document.getElementById('main-footer').classList.remove('hidden');
            showSection('guest-home');
        }

        function renderProducts() {
            const grid = document.getElementById('product-display-grid');
            grid.innerHTML = '<div class="col-span-full text-center py-12 text-slate-600"><i class="fa-solid fa-spinner fa-spin text-2xl mb-2 block"></i>ƒêang t·∫£i d·ªØ li·ªáu...</div>';
            if (typeof db === 'undefined') {
                displayProductCards(SAMPLE_PRODUCTS, grid);
                return;
            }
            db.collection('projects').orderBy('createdAt', 'desc').get().then((querySnapshot) => {
                grid.innerHTML = '';
                const products = [];
                querySnapshot.forEach((doc) => { products.push({ id: doc.id, ...doc.data() }); });
                const allProducts = [...products, ...SAMPLE_PRODUCTS];
                displayProductCards(allProducts, grid);
            }).catch(() => { displayProductCards(SAMPLE_PRODUCTS, grid); });
        }

        function displayProductCards(data, container) {
            container.innerHTML = '';
            if (!data || data.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center py-12 text-slate-600">Kh√¥ng c√≥ d·ª± √°n n√†o.</div>';
                return;
            }
            data.forEach(p => {
                container.innerHTML += `
                    <div class="product-card">
                        <div class="h-44 w-full mb-4 rounded-xl overflow-hidden relative group">
                            <img src="${p.image || 'https://images.unsplash.com/photo-1461749280684-dccba630e2f6?w=400&q=80'}"
                                 class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700" alt="${p.name}"
                                 onerror="this.src='https://images.unsplash.com/photo-1461749280684-dccba630e2f6?w=400&q=80'">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex items-end justify-center pb-4">
                                ${p.fileUrl ? `<a href="${p.fileUrl}" target="_blank" class="bg-blue-600 text-white px-4 py-2 rounded-full font-bold text-xs hover:bg-blue-500 shadow-lg"><i class="fa-solid fa-play mr-1"></i> M·ªü File</a>` : ''}
                            </div>
                        </div>
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="text-base font-bold text-white truncate w-3/4">${p.name}</h3>
                            <span class="text-xs font-semibold px-2 py-1 rounded-lg bg-blue-900/40 text-blue-300 border border-blue-500/20">${p.tech}</span>
                        </div>
                        <p class="text-xs text-slate-500 mb-2">${p.category || ''}</p>
                        <p class="text-xs text-slate-400 line-clamp-2 leading-relaxed">${p.desc || ''}</p>
                        ${p.author ? `<p class="text-xs text-slate-600 mt-3 flex items-center gap-1"><i class="fa-solid fa-user text-blue-400/40"></i> ${p.author}</p>` : ''}
                    </div>
                `;
            });
        }

        /* ===== SEARCH ===== */
        function handleSearchInput(val) {
            const suggestionBox = document.getElementById('search-suggestions');
            if (!val) { suggestionBox.style.display = 'none'; return; }
            const matched = SAMPLE_PRODUCTS.filter(p =>
                p.name.toLowerCase().includes(val.toLowerCase()) ||
                p.tech.toLowerCase().includes(val.toLowerCase())
            );
            if (matched.length > 0) {
                suggestionBox.innerHTML = matched.map(p => `
                    <div class="search-item" onclick="selectSearchItem('${p.name}')">
                        <div class="font-semibold text-sm text-white">${p.name}</div>
                        <div class="text-xs text-slate-500">${p.category} ¬∑ ${p.tech}</div>
                    </div>
                `).join('');
                suggestionBox.style.display = 'block';
            } else {
                suggestionBox.innerHTML = '<div class="p-4 text-slate-500 text-sm italic">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o...</div>';
                suggestionBox.style.display = 'block';
            }
        }

        function selectSearchItem(name) {
            document.getElementById('product-search').value = name;
            document.getElementById('search-suggestions').style.display = 'none';
            displayProductCards(SAMPLE_PRODUCTS.filter(p => p.name === name), document.getElementById('product-display-grid'));
        }

        function handleSearchEnter(e) {
            if (e.key === 'Enter') {
                const val = e.target.value.toLowerCase();
                const results = SAMPLE_PRODUCTS.filter(p =>
                    p.name.toLowerCase().includes(val) || p.tech.toLowerCase().includes(val) || (p.category || '').toLowerCase().includes(val)
                );
                displayProductCards(results, document.getElementById('product-display-grid'));
                document.getElementById('search-suggestions').style.display = 'none';
                if (results.length === 0) showToast("Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ ph√π h·ª£p");
            }
        }

        /* ===== AUTH ===== */
        function checkLoginState() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (currentUser) renderUserInterface(currentUser);
            else renderGuestHome();
        }

        function handleRegister() {
            const user = document.getElementById('reg-user').value;
            const email = document.getElementById('reg-email').value;
            const pass = document.getElementById('reg-pass').value;
            if (!user || !email || !pass) { alert("Vui l√≤ng nh·∫≠p ƒë·ªß th√¥ng tin!"); return; }
            if (typeof auth === 'undefined') { alert("Firebase ch∆∞a kh·ªüi t·∫°o!"); return; }
            auth.createUserWithEmailAndPassword(email, pass)
                .then((userCredential) => {
                    userCredential.user.updateProfile({ displayName: user, photoURL: AVATARS[0] }).then(() => {
                        showToast('ƒêƒÉng k√Ω th√†nh c√¥ng!');
                        db.collection('users').doc(userCredential.user.uid).set({ username: user, email: email, role: 'member' });
                        showSection('user-dashboard');
                    });
                }).catch((error) => { alert("L·ªói ƒëƒÉng k√Ω: " + error.message); });
        }

        function handleLogin() {
            const email = document.getElementById('login-user').value;
            const pass = document.getElementById('login-pass').value;
            if (typeof auth === 'undefined') { alert("Firebase ch∆∞a kh·ªüi t·∫°o!"); return; }
            auth.signInWithEmailAndPassword(email, pass)
                .then(() => { showToast('ƒêƒÉng nh·∫≠p th√†nh c√¥ng!'); })
                .catch((error) => { alert("L·ªói ƒëƒÉng nh·∫≠p: " + error.message); });
        }

        function renderUserInterface(userData) {
            document.getElementById('header-guest').classList.add('hidden');
            document.getElementById('header-user').classList.remove('hidden');
            document.getElementById('header-username').textContent = userData.username;
            document.getElementById('header-avatar').src = userData.avatar || AVATARS[0];
            document.getElementById('dropdown-name').textContent = userData.username;
            const welcomeEl = document.getElementById('welcome-username');
            if (welcomeEl) welcomeEl.textContent = userData.username;
            document.getElementById('main-footer').classList.add('hidden');
            showSection('user-dashboard');
            setActiveNav('nav-my-projects');
        }

        function toggleDropdown() {
            const dd = document.getElementById('user-dropdown');
            const chevron = document.getElementById('dropdown-chevron');
            dd.classList.toggle('hidden-dropdown');
            dd.classList.toggle('visible-dropdown');
            if (chevron) chevron.style.transform = dd.classList.contains('visible-dropdown') ? 'rotate(180deg)' : '';
        }

        function openProfilePage() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser) return;
            document.getElementById('edit-name').value = currentUser.username;
            document.getElementById('edit-email').value = currentUser.email;
            document.getElementById('profile-current-avatar').src = currentUser.avatar || AVATARS[0];
            tempSelectedAvatar = currentUser.avatar || AVATARS[0];
            const grid = document.getElementById('avatar-grid');
            grid.innerHTML = '';
            AVATARS.forEach(url => {
                const img = document.createElement('img');
                img.src = url;
                img.className = `w-14 h-14 rounded-full cursor-pointer border-2 transition-all avatar-option ${url === currentUser.avatar ? 'border-blue-500' : 'border-transparent hover:border-slate-500'}`;
                img.onclick = () => {
                    document.querySelectorAll('.avatar-option').forEach(el => { el.classList.remove('border-blue-500'); el.classList.add('border-transparent'); });
                    img.classList.remove('border-transparent'); img.classList.add('border-blue-500');
                    document.getElementById('profile-current-avatar').src = url;
                    tempSelectedAvatar = url;
                };
                grid.appendChild(img);
            });
            showSection('profile-page');
        }

        function preSaveCheck() { document.getElementById('save-modal').classList.remove('hidden'); }

        function performSaveProfile() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const newPassword = document.getElementById('edit-password').value;
            const confirmPassword = document.getElementById('edit-password-confirm').value;
            if (newPassword || confirmPassword) {
                if (newPassword.length < 6) { alert("M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±"); return; }
                if (newPassword !== confirmPassword) { alert("M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp"); return; }
            }
            const updatedUser = { ...currentUser, username: document.getElementById('edit-name').value, email: document.getElementById('edit-email').value, avatar: tempSelectedAvatar, password: newPassword ? newPassword : currentUser.password };
            localStorage.setItem('savedUser', JSON.stringify(updatedUser));
            localStorage.setItem('currentUser', JSON.stringify(updatedUser));
            document.getElementById('edit-password').value = '';
            document.getElementById('edit-password-confirm').value = '';
            closeModal('save-modal');
            showToast('C·∫≠p nh·∫≠t h·ªì s∆° th√†nh c√¥ng!');
        }

        function confirmLogout() { document.getElementById('logout-modal').classList.remove('hidden'); }

        function performLogout() {
            if (typeof auth !== 'undefined') auth.signOut();
            localStorage.removeItem('currentUser');
            closeModal('logout-modal');
            renderGuestHome();
            showToast('ƒê√£ ƒëƒÉng xu·∫•t.');
        }

        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const icon = toast.querySelector('i');
            document.getElementById('toast-msg').innerText = message;
            icon.className = type === 'error' ? 'fa-solid fa-circle-xmark text-red-400' : 'fa-solid fa-circle-check text-green-400';
            toast.classList.remove('translate-x-[150%]');
            setTimeout(() => toast.classList.add('translate-x-[150%]'), 3500);
        }

        window.onclick = function(event) {
            if (!event.target.closest('.relative') && !event.target.closest('#user-dropdown')) {
                const dd = document.getElementById('user-dropdown');
                if (dd) { dd.classList.add('hidden-dropdown'); dd.classList.remove('visible-dropdown'); }
            }
        };
    </script>

    <!-- ===================================================================
         COMMUNITY MODULE SCRIPT
         All functions prefixed "comm" ‚Äî zero impact on existing code.
         Activated only after Firebase confirms user is logged in.
    ==================================================================== -->
    <script>
    // ‚îÄ‚îÄ Config (edit these to match your backend) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const COMM_API_BASE  = 'http://localhost:4000';
    const COMM_SOCKET_URL = 'http://localhost:4000';

    // ‚îÄ‚îÄ Guard: require login before showing community ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function commRequireLogin() {
        const cu = JSON.parse(localStorage.getItem('currentUser'));
        if (!cu) {
            showSection('login-section');
            commShowToast('‚ö†Ô∏è Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ d√πng t√≠nh nƒÉng c·ªông ƒë·ªìng!', 'error');
            return false;
        }
        showSection('community-section');
        return true;
    }

    // ‚îÄ‚îÄ View navigation (community sub-views) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function showCommView(name) {
        // Make sure community-section is visible
        showSection('community-section');
        document.querySelectorAll('.comm-view').forEach(v => v.classList.remove('comm-active'));
        const el = document.getElementById('comm-view-' + name);
        if (el) el.classList.add('comm-active');
        // Trigger data loads
        if (name === 'community')   { commLoadLeaderboardMini(); commLoadPosts(); }
        if (name === 'forum')       { commLoadForumPosts(); }
        if (name === 'timeline')    { commLoadTimeline(); }
        if (name === 'leaderboard') { commLoadLeaderboardFull(); }
        if (name === 'share')       { commLoadShareList(); }
        if (name === 'chat')        { /* chat loads on socket connect */ }
    }

    // ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function commGetUser() {
        return JSON.parse(localStorage.getItem('currentUser')) || { username: 'TC3 Member', uid: 'guest' };
    }

    async function commApi(method, path, body) {
        const opts = { method, headers: { 'Content-Type': 'application/json' } };
        if (body) opts.body = JSON.stringify(body);
        try {
            const r = await fetch(COMM_API_BASE + path, opts);
            return await r.json();
        } catch (e) {
            return null; // demo/offline mode
        }
    }

    function commTimeAgo(date) {
        if (!date) return '';
        const d = date instanceof Date ? date : new Date(date);
        const diff = (Date.now() - d.getTime()) / 1000;
        if (diff < 60) return 'v·ª´a xong';
        if (diff < 3600) return Math.floor(diff / 60) + ' ph√∫t tr∆∞·ªõc';
        if (diff < 86400) return Math.floor(diff / 3600) + ' gi·ªù tr∆∞·ªõc';
        return Math.floor(diff / 86400) + ' ng√†y tr∆∞·ªõc';
    }

    function commEscHtml(str) {
        return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }

    let commToastTimer;
    function commShowToast(msg, type = 'success') {
        const t = document.getElementById('comm-toast');
        if (!t) return;
        t.textContent = msg;
        t.className = `comm-show comm-${type}`;
        clearTimeout(commToastTimer);
        commToastTimer = setTimeout(() => t.classList.remove('comm-show'), 3200);
    }

    // ‚îÄ‚îÄ Socket.io (community-only socket) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let commSocket;
    (function initCommSocket() {
        try {
            commSocket = io(COMM_SOCKET_URL, { transports: ['websocket', 'polling'], autoConnect: false });

            commSocket.on('chat:history', msgs => {
                msgs.forEach(m => commAppendChatMsg(m, 'comm-mini-chat-box'));
                msgs.forEach(m => commAppendChatMsg(m, 'comm-chat-full-box'));
                commScrollChat('comm-mini-chat-box');
                commScrollChat('comm-chat-full-box');
            });
            commSocket.on('chat:message', msg => {
                commAppendChatMsg(msg, 'comm-mini-chat-box');
                commAppendChatMsg(msg, 'comm-chat-full-box');
                commScrollChat('comm-mini-chat-box');
                commScrollChat('comm-chat-full-box');
            });
            commSocket.on('timeline:new', item => commPrependTimeline(item));
            commSocket.on('timeline:batch', items => {
                items.forEach(item => { if (!document.getElementById('ctli-' + item.id)) commPrependTimeline(item); });
            });
            commSocket.on('post:new', () => commLoadPosts());
            commSocket.on('connect', () => {
                const oc = document.getElementById('comm-online-count');
                if (oc) oc.textContent = (Math.floor(Math.random() * 8) + 2) + ' online';
            });
        } catch(e) {
            commSocket = { emit: () => {}, connected: false };
        }
    })();

    // Connect socket only when community section is first opened
    let _commSocketConnected = false;
    function commEnsureSocket() {
        if (!_commSocketConnected && commSocket && commSocket.connect) {
            commSocket.connect();
            _commSocketConnected = true;
        }
    }

    // ‚îÄ‚îÄ LEADERBOARD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const COMM_DEMO_LB = [
        { username:'Nguy·ªÖn Minh An',  points:142, avatar:'' },
        { username:'Tr·∫ßn Thu H√†',      points:118, avatar:'' },
        { username:'L√™ Qu·ªëc Huy',     points:95,  avatar:'' },
        { username:'Ph·∫°m Y·∫øn Linh',   points:73,  avatar:'' },
        { username:'V√µ B·∫£o Ch√¢u',     points:61,  avatar:'' },
    ];

    async function commLoadLeaderboardMini() {
        const data = await commApi('GET', '/api/leaderboard') || { top: COMM_DEMO_LB };
        const el = document.getElementById('comm-lb-mini');
        if (!el) return;
        el.innerHTML = '';
        (data.top || []).forEach((u, i) => {
            const rc = i===0?'comm-rank-1':i===1?'comm-rank-2':i===2?'comm-rank-3':'comm-rank-other';
            const ini = (u.username||u.name||'?')[0].toUpperCase();
            el.innerHTML += `
              <div class="comm-lb-row">
                <div class="comm-lb-rank ${rc}">${i+1}</div>
                <div class="comm-lb-ava">${u.avatar?`<img src="${u.avatar}">`:'<span style="color:#fff">'+ini+'</span>'}</div>
                <div class="comm-lb-info">
                  <div class="comm-lb-name">${u.username||u.name||'Th√†nh vi√™n'}</div>
                  <div class="comm-lb-pts">${u.points||0} ƒëi·ªÉm</div>
                </div>
                <div class="comm-lb-badge">${['ü•á','ü•à','ü•â','‚≠ê','‚≠ê'][i]}</div>
              </div>`;
        });
    }

    async function commLoadLeaderboardFull() {
        const now = new Date();
        const lbl = document.getElementById('comm-lb-month-label');
        if (lbl) lbl.textContent = `Th√°ng ${now.getMonth()+1}/${now.getFullYear()}`;
        const data = await commApi('GET', '/api/leaderboard') || { top: COMM_DEMO_LB };
        const el = document.getElementById('comm-lb-full-list');
        if (!el) return;
        el.innerHTML = '';
        const maxPts = (data.top[0]||{}).points || 1;
        (data.top||[]).forEach((u, i) => {
            const rc = ['comm-rank-gold','comm-rank-silver','comm-rank-bronze','',''][i];
            const ini = (u.username||u.name||'?')[0].toUpperCase();
            const pct = Math.round(((u.points||0)/maxPts)*100);
            el.innerHTML += `
              <div class="comm-lb-full-row">
                <div class="comm-lb-full-rank ${rc}">${['ü•á','ü•à','ü•â','4','5'][i]}</div>
                <div class="comm-lb-full-ava">${u.avatar?`<img src="${u.avatar}">`:'<span style="color:#fff">'+ini+'</span>'}</div>
                <div class="comm-lb-full-info">
                  <div class="comm-lb-full-name">${u.username||u.name||'Th√†nh vi√™n'}</div>
                  <div class="comm-lb-full-sub">Th√†nh vi√™n TC3 TECH-HUB</div>
                  <div class="comm-progress-bar"><div class="comm-progress-fill" style="width:${pct}%"></div></div>
                </div>
                <div class="comm-lb-full-pts">${u.points||0} ƒëi·ªÉm</div>
              </div>`;
        });
    }

    // ‚îÄ‚îÄ POSTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let commCurrentPosts = [];
    let commPostLastId   = null;
    let commCurrentTags  = [];
    let commShowCode     = false;
    let commUploadedImg  = '';

    const COMM_DEMO_POSTS = [
        { id:'cd1', title:'L√†m sao ƒë·ªÉ h·ªçc JavaScript nhanh?', content:'M√¨nh ƒëang h·ªçc JS nh∆∞ng th·∫•y kh√° kh√≥, ƒë·∫∑c bi·ªát l√† ph·∫ßn async/await. C√≥ ai c√≥ kinh nghi·ªám h·ªçc JS hi·ªáu qu·∫£ kh√¥ng ·∫°?', tags:['js','question'], authorName:'Nguy·ªÖn Minh An', avatar:'', likes:12, comments:3, createdAt:new Date(Date.now()-3600000), codeSnippet:"async function fetchData() {\n  const res = await fetch('/api/data');\n  return res.json();\n}", imageURL:'' },
        { id:'cd2', title:'Project Scratch Game ‚Äî Flappy Bird!', content:'M√¨nh v·ª´a ho√†n th√†nh game Flappy Bird b·∫±ng Scratch! M·∫•t 2 tu·∫ßn ƒë·ªÉ l√†m xong v·ªõi ƒë·∫ßy ƒë·ªß t√≠nh nƒÉng: ƒëi·ªÉm s·ªë, hi·ªáu ·ª©ng √¢m thanh v√† m√†n h√¨nh game over.', tags:['scratch','share'], authorName:'Tr·∫ßn Thu H√†', avatar:'', likes:28, comments:7, createdAt:new Date(Date.now()-7200000), codeSnippet:'', imageURL:'' },
        { id:'cd3', title:'Python cho ng∆∞·ªùi m·ªõi b·∫Øt ƒë·∫ßu ‚Äî Resources hay', content:'List c√°c resource h·ªçc Python mi·ªÖn ph√≠ m√† m√¨nh th·∫•y hi·ªáu qu·∫£ nh·∫•t:\n1. CS50P c·ªßa Harvard\n2. Python.org docs ch√≠nh th·ª©c\n3. Automate the Boring Stuff', tags:['python'], authorName:'L√™ Qu·ªëc Huy', avatar:'', likes:45, comments:11, createdAt:new Date(Date.now()-86400000), codeSnippet:"print('TC3 TECH-HUB 11A1 üöÄ')\nfor i in range(5):\n    print(f'B∆∞·ªõc {i+1}')", imageURL:'' }
    ];

    function commPreviewImg(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = e => {
            commUploadedImg = e.target.result;
            const prev = document.getElementById('comm-c-img-preview');
            if (prev) { prev.src = commUploadedImg; prev.classList.add('show'); }
        };
        reader.readAsDataURL(file);
    }

    function commToggleCode() {
        commShowCode = !commShowCode;
        const el = document.getElementById('comm-c-code');
        if (el) el.style.display = commShowCode ? 'block' : 'none';
        const btn = document.getElementById('comm-code-toggle');
        if (btn) btn.classList.toggle('comm-active', commShowCode);
    }

    function commAddTag(event) {
        if (event.key !== 'Enter') return;
        const input = document.getElementById('comm-tag-input');
        const tag = (input.value||'').trim().toLowerCase().replace(/[^a-z0-9]/g,'');
        if (!tag || commCurrentTags.includes(tag)) { input.value = ''; return; }
        commCurrentTags.push(tag);
        input.value = '';
        commRenderTagChips();
    }

    function commRenderTagChips() {
        const row = document.getElementById('comm-tags-row');
        if (!row) return;
        row.querySelectorAll('.comm-tag-chip').forEach(c => c.remove());
        commCurrentTags.forEach(tag => {
            const chip = document.createElement('span');
            chip.className = 'comm-tag-chip';
            chip.innerHTML = `#${tag} <span class="ctrm" onclick="commRemoveTag('${tag}')">‚úï</span>`;
            row.insertBefore(chip, document.getElementById('comm-tag-input'));
        });
    }

    function commRemoveTag(tag) {
        commCurrentTags = commCurrentTags.filter(t => t !== tag);
        commRenderTagChips();
    }

    async function commSubmitPost() {
        const cu = commGetUser();
        const title   = (document.getElementById('comm-c-title')||{}).value?.trim();
        const content = (document.getElementById('comm-c-content')||{}).value?.trim();
        if (!title || !content) { commShowToast('‚ö†Ô∏è Nh·∫≠p ti√™u ƒë·ªÅ v√† n·ªôi dung!','error'); return; }

        const postData = {
            title, content,
            tags: [...commCurrentTags],
            imageURL: commUploadedImg,
            codeSnippet: (document.getElementById('comm-c-code')||{}).value?.trim() || ''
        };

        // Optimistic UI ‚Äî add locally right away
        const localPost = { id:'lp_'+Date.now(), ...postData, authorName:cu.username, avatar:cu.avatar||'', likes:0, comments:0, createdAt:new Date() };
        commCurrentPosts.unshift(localPost);
        commRenderPost(localPost, 'comm-post-feed', true);
        commRenderPost(localPost, 'comm-forum-feed', true);

        // Reset form
        ['comm-c-title','comm-c-content','comm-c-code'].forEach(id => { const el = document.getElementById(id); if(el) el.value=''; });
        commUploadedImg = ''; commCurrentTags = []; commRenderTagChips();
        const prev = document.getElementById('comm-c-img-preview');
        if (prev) { prev.src=''; prev.classList.remove('show'); }

        commShowToast('üöÄ ƒêƒÉng b√†i th√†nh c√¥ng! +5 ƒëi·ªÉm', 'success');

        // Try API
        await commApi('POST', '/api/posts', postData);
    }

    async function commLoadPosts(tag) {
        const container = document.getElementById('comm-post-feed');
        if (!container) return;
        if (!commCurrentPosts.length) container.innerHTML = `<div style="padding:20px;text-align:center;color:#6b7280"><div class="comm-spinner"></div></div>`;
        const qs = tag ? `?tag=${tag}` : '';
        const data = await commApi('GET', '/api/posts' + qs);
        const posts = data?.posts || COMM_DEMO_POSTS;
        commCurrentPosts = posts;
        commPostLastId = data?.nextId;
        container.innerHTML = '';
        posts.forEach(p => commRenderPost(p, 'comm-post-feed'));
        const btn = document.getElementById('comm-load-more-btn');
        if (btn) btn.style.display = commPostLastId ? 'block' : 'none';
    }

    async function commLoadForumPosts(tag) {
        const container = document.getElementById('comm-forum-feed');
        if (!container) return;
        container.innerHTML = `<div style="padding:20px;text-align:center;color:#6b7280"><div class="comm-spinner"></div></div>`;
        const qs = tag ? `?tag=${tag}` : '';
        const data = await commApi('GET', '/api/posts' + qs);
        const posts = data?.posts || COMM_DEMO_POSTS;
        container.innerHTML = '';
        posts.forEach(p => commRenderPost(p, 'comm-forum-feed'));
    }

    async function commLoadMorePosts() {
        if (!commPostLastId) return;
        const data = await commApi('GET', `/api/posts?lastId=${commPostLastId}`);
        if (data?.posts) {
            data.posts.forEach(p => { commCurrentPosts.push(p); commRenderPost(p, 'comm-post-feed'); });
            commPostLastId = data.nextId;
        }
        const btn = document.getElementById('comm-load-more-btn');
        if (btn && !commPostLastId) btn.style.display = 'none';
    }

    function commFilterPosts(tag, btn) {
        document.querySelectorAll('#comm-filter-bar .comm-filter-tag').forEach(b => b.classList.remove('comm-active'));
        btn.classList.add('comm-active');
        commLoadPosts(tag);
    }

    function commFilterForumPosts(tag, btn) {
        document.querySelectorAll('#comm-forum-filter-bar .comm-filter-tag').forEach(b => b.classList.remove('comm-active'));
        btn.classList.add('comm-active');
        commLoadForumPosts(tag);
    }

    function commRenderPost(p, containerId, prepend = false) {
        const container = document.getElementById(containerId);
        if (!container) return;
        const ini = (p.authorName||'?')[0].toUpperCase();
        const tagsHtml = (p.tags||[]).map(t => `<span class="comm-p-tag">#${t}</span>`).join('');
        const el = document.createElement('div');
        el.className = 'comm-post-card';
        el.id = 'cpost-' + p.id;
        el.innerHTML = `
          <div class="comm-post-head">
            <div class="comm-post-avatar">${p.avatar?`<img src="${p.avatar}">`:'<span style="color:#fff">'+ini+'</span>'}</div>
            <div class="comm-post-meta">
              <div class="comm-post-author">${p.authorName||'Th√†nh vi√™n'}</div>
              <div class="comm-post-time">${commTimeAgo(p.createdAt)}</div>
            </div>
            <div class="comm-post-tags-top">${tagsHtml}</div>
          </div>
          <div class="comm-post-body">
            <div class="comm-post-title">${p.title}</div>
            <div class="comm-post-content">${p.content||''}</div>
            ${p.imageURL?`<img src="${p.imageURL}" class="comm-post-image" onerror="this.style.display='none'">`:''}
            ${p.codeSnippet?`<div class="comm-post-code">${commEscHtml(p.codeSnippet)}</div>`:''}
          </div>
          <div class="comm-post-actions">
            <button class="comm-act-btn" id="comm-like-${p.id}" onclick="commLikePost('${p.id}',this)">
              ‚ù§Ô∏è Th√≠ch <span>${p.likes||0}</span>
            </button>
            <button class="comm-act-btn" onclick="commToggleComments('${p.id}')">
              üí¨ B√¨nh lu·∫≠n <span>${p.comments||0}</span>
            </button>
            <button class="comm-act-btn" onclick="commSharePostLink('${p.id}')">
              üîó Chia s·∫ª
            </button>
          </div>
          <div class="comm-comments-area" id="ccmt-${p.id}">
            <div id="ccmt-list-${p.id}"></div>
            <div class="comm-add-comment-row">
              <input class="comm-cmt-input" id="ccmt-input-${p.id}" placeholder="Vi·∫øt b√¨nh lu·∫≠n..." onkeydown="if(event.key==='Enter')commAddComment('${p.id}')"/>
              <button class="comm-cmt-send" onclick="commAddComment('${p.id}')">G·ª≠i</button>
            </div>
          </div>`;
        if (prepend && container.firstChild) container.insertBefore(el, container.firstChild);
        else container.appendChild(el);
    }

    async function commLikePost(postId, btn) {
        btn.classList.add('comm-liked');
        const span = btn.querySelector('span');
        if (span) span.textContent = parseInt(span.textContent||0)+1;
        await commApi('POST', `/api/posts/${postId}/like`);
    }

    async function commToggleComments(postId) {
        const area = document.getElementById('ccmt-' + postId);
        if (!area) return;
        if (area.classList.contains('open')) { area.classList.remove('open'); return; }
        area.classList.add('open');
        const data = await commApi('GET', `/api/posts/${postId}`);
        const list = document.getElementById('ccmt-list-' + postId);
        if (list) { list.innerHTML = ''; (data?.comments||[]).forEach(c => commAppendComment(c, postId)); }
    }

    function commAppendComment(c, postId) {
        const list = document.getElementById('ccmt-list-' + postId);
        if (!list) return;
        const ini = (c.authorName||'?')[0].toUpperCase();
        const el = document.createElement('div');
        el.className = 'comm-comment-item';
        el.innerHTML = `
          <div class="comm-cmt-ava">${c.avatar?`<img src="${c.avatar}">`:'<span style="color:#fff">'+ini+'</span>'}</div>
          <div class="comm-cmt-body">
            <div class="comm-cmt-name">${c.authorName||'Th√†nh vi√™n'}</div>
            <div class="comm-cmt-text">${c.content}</div>
            <div class="comm-cmt-likes" onclick="commLikeComment('${postId}','${c.id}',this)">üëç ${c.likes||0}</div>
          </div>`;
        list.appendChild(el);
    }

    async function commAddComment(postId) {
        const input = document.getElementById('ccmt-input-' + postId);
        const content = (input?.value||'').trim();
        if (!content) return;
        input.value = '';
        const cu = commGetUser();
        commAppendComment({ id:'cc_'+Date.now(), content, authorName:cu.username, avatar:cu.avatar||'', likes:0 }, postId);
        const btn = document.querySelector(`#cpost-${postId} .comm-act-btn:nth-child(2) span`);
        if (btn) btn.textContent = parseInt(btn.textContent||0)+1;
        await commApi('POST', `/api/posts/${postId}/comments`, { content });
        commShowToast('üí¨ ƒê√£ g·ª≠i b√¨nh lu·∫≠n! +2 ƒëi·ªÉm', 'success');
    }

    async function commLikeComment(postId, cid, el) {
        el.textContent = 'üëç ' + (parseInt(el.textContent.replace('üëç ','')||0)+1);
        await commApi('POST', `/api/posts/${postId}/comments/${cid}/like`);
    }

    function commSharePostLink(postId) {
        const url = window.location.href.split('#')[0] + '#cpost=' + postId;
        navigator.clipboard?.writeText(url).then(() => commShowToast('üîó ƒê√£ sao ch√©p link!','success'));
    }

    // ‚îÄ‚îÄ TIMELINE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const COMM_DEMO_TL = [
        { id:'ct1', type:'post',   userName:'Nguy·ªÖn Minh An', message:'ƒë√£ ƒëƒÉng b√†i: "C√°ch h·ªçc JS hi·ªáu qu·∫£"',     createdAt:new Date(Date.now()-120000) },
        { id:'ct2', type:'share',  userName:'Tr·∫ßn Thu H√†',     message:'ƒë√£ chia s·∫ª d·ª± √°n: "Flappy Bird Scratch"', createdAt:new Date(Date.now()-3600000) },
        { id:'ct3', type:'upload', userName:'L√™ Qu·ªëc Huy',    message:'ƒë√£ t·∫£i l√™n project m·ªõi: "Calculator Python"', createdAt:new Date(Date.now()-7200000) },
    ];
    const COMM_TL_ICONS = { post:'‚úçÔ∏è', share:'üîó', upload:'üì¶', comment:'üí¨', like:'‚ù§Ô∏è' };

    async function commLoadTimeline() {
        const container = document.getElementById('comm-timeline-feed');
        if (!container) return;
        const data = await commApi('GET', '/api/timeline');
        const items = data?.items || COMM_DEMO_TL;
        container.innerHTML = '';
        items.forEach(item => commPrependTimeline(item));
    }

    function commPrependTimeline(item) {
        const container = document.getElementById('comm-timeline-feed');
        if (!container || document.getElementById('ctli-'+item.id)) return;
        const el = document.createElement('div');
        el.className = 'comm-tl-item';
        el.id = 'ctli-' + item.id;
        el.innerHTML = `
          <div class="comm-tl-icon ${item.type||'post'}">${COMM_TL_ICONS[item.type]||'üîî'}</div>
          <div class="comm-tl-body">
            <div class="comm-tl-msg"><strong>${item.userName||'Th√†nh vi√™n'}</strong> ${item.message||''}</div>
            <div class="comm-tl-time">${commTimeAgo(item.createdAt||new Date())}</div>
          </div>`;
        if (container.firstChild) container.insertBefore(el, container.firstChild);
        else container.appendChild(el);
        // Remove loading spinner if present
        const sp = container.querySelector('.comm-spinner');
        if (sp && sp.parentElement !== el) sp.parentElement?.remove();
    }

    // ‚îÄ‚îÄ LIVE CHAT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function commAppendChatMsg(msg, boxId) {
        const box = document.getElementById(boxId);
        if (!box) return;
        const cu = commGetUser();
        const isMe = msg.userId === cu.uid;
        const ini = (msg.userName||'?')[0].toUpperCase();
        const el = document.createElement('div');
        el.className = 'comm-chat-msg' + (isMe ? ' comm-me' : '');
        el.innerHTML = `
          <div class="cc-ava">${ini}</div>
          <div class="cc-body">
            <div class="cc-name">${msg.userName||'Th√†nh vi√™n'}</div>
            <div class="cc-text">${msg.text||''}</div>
          </div>`;
        box.appendChild(el);
    }

    function commScrollChat(id) {
        const box = document.getElementById(id);
        if (box) box.scrollTop = box.scrollHeight;
    }

    function _commSendChat(inputId) {
        const input = document.getElementById(inputId);
        const text = (input?.value||'').trim();
        if (!text) return;
        input.value = '';
        const cu = commGetUser();
        commEnsureSocket();
        const msg = { text, userName:cu.username, userId:cu.uid, avatar:cu.avatar||'', ts:new Date().toISOString(), id:Date.now().toString() };
        if (commSocket && commSocket.emit) commSocket.emit('chat:send', msg);
        // Optimistic (offline/no socket)
        if (!commSocket.connected) {
            commAppendChatMsg(msg, 'comm-mini-chat-box');
            commAppendChatMsg(msg, 'comm-chat-full-box');
            commScrollChat('comm-mini-chat-box');
            commScrollChat('comm-chat-full-box');
        }
    }

    function commSendMiniChat() { _commSendChat('comm-mini-chat-input'); }
    function commSendFullChat()  { _commSendChat('comm-chat-full-input'); }

    // ‚îÄ‚îÄ SHARE PROJECT (list user's own projects) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function commLoadShareList() {
        const container = document.getElementById('comm-share-project-list');
        if (!container) return;
        // Load from Firebase (if available) or show demo
        let projects = [];
        if (typeof db !== 'undefined') {
            try {
                const cu = commGetUser();
                const snap = await db.collection('projects').where('authorId','==',cu.uid).get();
                snap.forEach(doc => projects.push({ id:doc.id, ...doc.data() }));
            } catch(e) {}
        }
        if (!projects.length) {
            projects = [
                { id:'cp1', name:'Flappy Bird Scratch', tech:'Scratch' },
                { id:'cp2', name:'Calculator Python',   tech:'Python'  },
            ];
        }
        container.innerHTML = projects.length
            ? '<p style="font-size:0.8rem;color:#6b7280;margin-bottom:12px">Ch·ªçn d·ª± √°n b√™n d∆∞·ªõi ƒë·ªÉ chia s·∫ª l√™n c·ªông ƒë·ªìng:</p>'
            : '<p style="text-align:center;color:#6b7280;padding:24px;font-size:0.85rem">B·∫°n ch∆∞a c√≥ d·ª± √°n n√†o.</p>';
        projects.forEach(p => {
            const row = document.createElement('div');
            row.style.cssText='display:flex;align-items:center;justify-content:space-between;padding:13px 15px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);border-radius:10px;margin-bottom:9px;';
            row.innerHTML=`<div><div style="font-weight:700;font-size:0.88rem;color:#e8eaf0">${p.name}</div><div style="font-size:0.73rem;color:#6b7280">${p.tech||''}</div></div>
              <button class="comm-post-btn" style="font-size:0.78rem;padding:7px 16px" onclick="commShareProject('${p.id}','${p.name}')">üöÄ Chia s·∫ª</button>`;
            container.appendChild(row);
        });
    }

    async function commShareProject(id, name) {
        await commApi('POST', `/api/projects/${id}/share`);
        commShowToast(`üöÄ ƒê√£ chia s·∫ª d·ª± √°n "${name}" l√™n c·ªông ƒë·ªìng!`, 'success');
    }

    // ‚îÄ‚îÄ Connect socket when community section is first activated ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // (hooked via showSection override below)
    const _origShowSection = showSection;
    window.showSection = function(id) {
        _origShowSection(id);
        if (id === 'community-section') {
            commEnsureSocket();
            // Default to community home if no sub-view active
            const anyActive = document.querySelector('.comm-view.comm-active');
            if (!anyActive) showCommView('community');
        }
    };
    </script>

    <!-- ===== EXISTING SCRIPTS (untouched) ===== -->
    <script src="my-projects.js"></script>

    <!-- ===== FIREBASE ===== -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>

    <script src="my-projects-v2.js"></script>

    <!-- ===== NEW ENHANCEMENT SCRIPTS ===== -->
    <script src="vibe-animations.js"></script>
    <script src="demo-renderer.js"></script>

    <!-- ===== FIREBASE CONFIG ===== -->
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCg6YuV4Bi1baj0uGymBUANhZ9WqDfgXS4",
            authDomain: "my-web-2b363.firebaseapp.com",
            projectId: "my-web-2b363",
            storageBucket: "my-web-2b363.firebasestorage.app",
            messagingSenderId: "227910428181",
            appId: "1:227910428181:web:ec68c383aa20bab192101c",
            measurementId: "G-676GL2CFWJ"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        /* ===== AUTH STATE LISTENER ===== */
        auth.onAuthStateChanged((user) => {
            if (user) {
                const userData = {
                    username: user.displayName || 'TC3 Member',
                    email: user.email,
                    avatar: user.photoURL || AVATARS[0],
                    uid: user.uid
                };
                localStorage.setItem('currentUser', JSON.stringify(userData));
                renderUserInterface(userData);
            } else {
                localStorage.removeItem('currentUser');
                renderGuestHome();
            }
        });
    </script>
</body>
</html>
